<!DOCTYPE html>



  



<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="我的个人博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="我的个人博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我的个人博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>我的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">哪有什么胜利可言，挺着就代表着一切</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/11/SQLite的使用和实现一个简单的数据库框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/11/SQLite的使用和实现一个简单的数据库框架/" itemprop="url">SQLite的使用和实现一个简单的数据库框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-11T23:57:41+08:00">
                2019-06-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLite的基本知识"><a href="#SQLite的基本知识" class="headerlink" title="SQLite的基本知识"></a>SQLite的基本知识</h2><h3 id="SQLite常用的数据类型"><a href="#SQLite常用的数据类型" class="headerlink" title="SQLite常用的数据类型"></a>SQLite常用的数据类型</h3><table>
<thead>
<tr>
<th>字段</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>char(n)</td>
<td>固定<code>n</code>长度的字串</td>
</tr>
<tr>
<td>varchar(n)</td>
<td>长度不固定的字符串,<code>n</code>表示最大的长度</td>
</tr>
<tr>
<td>nchar(n)</td>
<td>同char，不同的是可以用来存储中文</td>
</tr>
<tr>
<td>nvarchar(n)</td>
<td>同varchar，不同的是可以用来存储中文</td>
</tr>
<tr>
<td>text</td>
<td>存储文本</td>
</tr>
<tr>
<td>blob</td>
<td>存储二进制文件</td>
</tr>
<tr>
<td>int</td>
<td>整形</td>
</tr>
<tr>
<td>integer</td>
<td>整形</td>
</tr>
<tr>
<td>bigint</td>
<td>整形</td>
</tr>
<tr>
<td>float</td>
<td>单精度类型</td>
</tr>
<tr>
<td>double</td>
<td>双精度浮点</td>
</tr>
</tbody>
</table>
<p>这里<code>int</code>、<code>integer</code>、<code>bigint</code>的具体区别，还没弄明白。如果有哪个大佬了解，请在评论区指导一下😄😄</p>
<h3 id="创建和删除数据表"><a href="#创建和删除数据表" class="headerlink" title="创建和删除数据表"></a>创建和删除数据表</h3><p>创建表的为语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> database_name.table_name(</span><br><span class="line">   column1 datatype  primary <span class="keyword">key</span>(one <span class="keyword">or</span> more <span class="keyword">columns</span>),</span><br><span class="line">   column2 datatype,</span><br><span class="line">   column3 datatype,</span><br><span class="line">   .....</span><br><span class="line">   columnN datatype,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>删除数据表的语法为<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> database_name.table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>插入数据表的语法为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name [(column1, column2, column3,...columnN)]  </span><br><span class="line"><span class="keyword">values</span> (value1, value2, value3,...valueN);</span><br><span class="line">或</span><br><span class="line">//注意：这种方式要确保值的顺序与列在表中的顺序一致</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name <span class="keyword">values</span> (value1,value2,value3,...valueN);</span><br></pre></td></tr></table></figure></p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>删除数据的语法为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name [条件];</span><br></pre></td></tr></table></figure></p>
<p>如果没有删除数据的条件，默认删除所有数据；如果指定了条件，则删除符合条件的<br>数据</p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>语法为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> table_name</span><br><span class="line"><span class="keyword">set</span> column1 = value1, column2 = value2...., columnN = valueN [条件];</span><br></pre></td></tr></table></figure></p>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>语法为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//查询指定字段（列）的值</span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, columnN <span class="keyword">FROM</span> table_name;</span><br><span class="line">或</span><br><span class="line">//查询所有字段的值</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure></p>
<h3 id="SQLite的逻辑运算符"><a href="#SQLite的逻辑运算符" class="headerlink" title="SQLite的逻辑运算符"></a>SQLite的逻辑运算符</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AND</code></td>
<td>AND 运算符允许在一个 SQL 语句的 WHERE 子句中的多个条件的存在</td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>BETWEEN 运算符用于在给定最小值和最大值范围内的一系列值中搜索值</td>
</tr>
<tr>
<td><code>EXISTS</code></td>
<td>EXISTS 运算符用于在满足一定条件的指定表中搜索行的存在</td>
</tr>
<tr>
<td><code>IN</code></td>
<td>IN 运算符用于把某个值与一系列指定列表的值进行比较</td>
</tr>
<tr>
<td><code>NOT IN</code></td>
<td>IN 运算符的对立面，用于把某个值与不在一系列指定列表的值进行比较</td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>LIKE 运算符用于把某个值与使用通配符运算符的相似值进行比较</td>
</tr>
<tr>
<td><code>GLOB</code></td>
<td>GLOB 运算符用于把某个值与使用通配符运算符的相似值进行比较。GLOB 与 LIKE 不同之处在于，它是大小写敏感的</td>
</tr>
<tr>
<td><code>NOT</code></td>
<td>NOT 运算符是所用的逻辑运算符的对立面。比如 NOT EXISTS、NOT BETWEEN、NOT IN，等等。它是否定运算符</td>
</tr>
<tr>
<td><code>OR</code></td>
<td>OR 运算符用于结合一个 SQL 语句的 WHERE 子句中的多个条件</td>
</tr>
<tr>
<td><code>IS NULL</code></td>
<td>NULL 运算符用于把某个值与 NULL 值进行比较</td>
</tr>
<tr>
<td><code>IS</code></td>
<td>IS 运算符与 = 相似</td>
</tr>
<tr>
<td><code>IS NOT</code></td>
<td><code>IS NOT</code> 运算符与 != 相似</td>
</tr>
<tr>
<td>`</td>
<td></td>
<td>`</td>
<td>连接两个不同的字符串，得到一个新的字符串</td>
</tr>
<tr>
<td><code>UNIQUE</code></td>
<td>UNIQUE 运算符搜索指定表中的每一行，确保唯一性（无重复）</td>
</tr>
</tbody>
</table>
<h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p><code>where</code>用来过滤数据的，例如<code>select * from employee where salary &gt;= 65000;</code>是指查询工资高于65000的员工的数据，使用<code>where salary &gt;= 65000;</code>来过滤数据</p>
<h3 id="and-or"><a href="#and-or" class="headerlink" title="and/or"></a>and/or</h3><p><code>and</code>相当于逻辑与运算，只有条件全为真时，结果才为真；<code>or</code>相当于逻辑或运算，只要其中一个条件为真，结果就为真。</p>
<h3 id="LIKE"><a href="#LIKE" class="headerlink" title="LIKE"></a>LIKE</h3><p><code>LIKE</code>运算符是用来匹配通配符指定模式的文本值。如果搜索表达式与模式表达式匹配，LIKE 运算符将返回真（true），也就是 1。这里有两个通配符与 LIKE 运算符一起使用：</p>
<ul>
<li>百分号 （%）</li>
<li>下划线 （_）</li>
</ul>
<p>百分号<code>（%）</code>代表零个、一个或多个数字或字符。下划线<code>（_）</code>代表一个单一的数字或字符。这些符号可以被组合使用。</p>
<p>下面一些实例演示了 带有 ‘%’ 和 ‘_’ 运算符的 LIKE 子句不同的地方：<br>|语句|描述|<br>|—-|—-|<br>|WHERE SALARY LIKE ‘200%’|查找以 200 开头的任意值|<br>|WHERE SALARY LIKE ‘%200%’|查找任意位置包含 200 的任意值|<br>|WHERE SALARY LIKE ‘<em>00%’|查找第二位和第三位为 00 的任意值|<br>|WHERE SALARY LIKE ‘2</em>%_%’|查找以 2 开头，且长度至少为 3 个字符的任意值|<br>|WHERE SALARY LIKE ‘%2’|查找以 2 结尾的任意值|<br>|WHERE SALARY LIKE ‘_2%3’|查找第二位为 2，且以 3 结尾的任意值|<br>|WHERE SALARY LIKE ‘2___3’|查找长度为 5 位数，且以 2 开头以 3 结尾的任意值|</p>
<h3 id="GLOB"><a href="#GLOB" class="headerlink" title="GLOB"></a>GLOB</h3><p><code>GLOB</code> 运算符是用来匹配通配符指定模式的文本值。如果搜索表达式与模式表达式匹配，<code>GLOB</code> 运算符将返回真（true），也就是 1。与 <code>LIKE</code> 运算符不同的是，<code>GLOB</code> 是大小写敏感的，对于下面的通配符，它遵循 UNIX 的语法。</p>
<ul>
<li>星号 （*）</li>
<li>问号 （?）</li>
</ul>
<p>星号<code>（*）</code>代表零个、一个或多个数字或字符。问号<code>（?）</code>代表一个单一的数字或字符。这些符号可以被组合使用。</p>
<table>
<thead>
<tr>
<th>语句</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>WHERE SALARY GLOB ‘200*’</td>
<td>查找以 200 开头的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘<em>200</em>‘</td>
<td>查找任意位置包含 200 的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘?00*’</td>
<td>查找第二位和第三位为 00 的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘2??’</td>
<td>查找以 2 开头，且长度至少为 3 个字符的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘*2’</td>
<td>查找以 2 结尾的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘?2*3’</td>
<td>查找第二位为 2，且以 3 结尾的任意值</td>
</tr>
<tr>
<td>WHERE SALARY GLOB ‘2???3’</td>
<td>查找长度为 5 位数，且以 2 开头以 3 结尾的任意值</td>
</tr>
</tbody>
</table>
<h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><p>子句用于限制由 SELECT 语句返回的数据数量</p>
<h3 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h3><p>子句是用来基于一个或多个列按升序或降序顺序排列数据。</p>
<p>ORDER BY 子句的基本语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>-<span class="keyword">list</span> </span><br><span class="line"><span class="keyword">FROM</span> table_name </span><br><span class="line">[<span class="keyword">WHERE</span> condition] </span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> column1, column2, .. columnN] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>];//ASC升序排序,DESC降序排序</span><br></pre></td></tr></table></figure></p>
<h3 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h3><p>子句用于与 SELECT 语句一起使用，来对相同的数据进行分组。<br>在 SELECT 语句中，GROUP BY 子句放在 WHERE 子句之后，放在 ORDER BY 子句之前</p>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>子句允许指定条件来过滤将出现在最终结果中的分组结果。<br>WHERE 子句在所选列上设置条件，而 HAVING 子句则在由 GROUP BY 子句创建的分组上设置条件。</p>
<h3 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h3><p>关键字与 SELECT 语句一起使用，来消除所有重复的记录，并只获取唯一一次记录。<br>有可能出现一种情况，在一个表中有多个重复的记录。当提取这样的记录时，DISTINCT 关键字就显得特别有意义，它只获取唯一一次记录，而不是获取重复记录。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">name</span> <span class="keyword">from</span> company;</span><br></pre></td></tr></table></figure></p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><blockquote>
<p>操作数据库，要使用SQLiteOpenHelper，由于SQLiteOpenHelper是抽象类，使用要实现它，并重写它的 onCreate(), onUpgrade()方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDatabase</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CreateTable_my=<span class="string">"create Table user("</span> +</span><br><span class="line">            <span class="string">"id primary key, name text, sex text , age integer, password text)"</span>;</span><br><span class="line"></span><br><span class="line">    Context myContext;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name    创建数据库的名字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory 用于返回自定义的Cursor，一般填null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> version 表示当前数据库的版本号，可用于对数据库进行升级</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Mydatabase</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, name, factory, version);</span><br><span class="line">        myContext=context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase sqLiteDatabase)</span> </span>&#123;</span><br><span class="line">          sqLiteDatabase.execSQL(CreateTable_my);<span class="comment">//创建表</span></span><br><span class="line">          Toast.makeText(myContext, <span class="string">"数据表创建成功"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase sqLiteDatabase, <span class="keyword">int</span> i, <span class="keyword">int</span> i1)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建MyDatabase的对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//first.db是数据库名</span><br><span class="line">private Mydatabase base=new Mydatabase(DatabaseActivity.this,&quot;first.db&quot;,null,1);</span><br></pre></td></tr></table></figure>
<p>生成数据库(会在<code>/data/data/&lt;package name&gt;/databases/</code>目录下建立数据库)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base.getWritableDatabase();</span><br><span class="line">//或者</span><br><span class="line">base.getReadableDatabase()</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>两个方法的不同处：<br><br><code>getWritableDatabase()</code>返回一个可对数据库进行读写操作的对象，会抛出异常<br><br><code>getReadableDatabase()</code>返回一个以只读方法打开的数据库，不会抛出异常</p>
</blockquote>
<h3 id="添加表"><a href="#添加表" class="headerlink" title="添加表"></a>添加表</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mydatabase</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line"><span class="comment">//用户表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CreateTable_user=<span class="string">"create Table user("</span> +</span><br><span class="line">            <span class="string">"id primary key, name text, sex text , age integer, password text)"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建另一个表，班级表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CreateTable_me=<span class="string">"create Table clazz("</span> +</span><br><span class="line">            <span class="string">"id primary key, className text, teacher text)"</span>;</span><br><span class="line"></span><br><span class="line">    Context myContext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name    创建数据库的名字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory 用于返回自定义的Cursor，一般填null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> version 表示当前数据库的版本号，可用于对数据库进行升级</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Mydatabase</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, name, factory, version);</span><br><span class="line">        myContext=context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase sqLiteDatabase)</span> </span>&#123;</span><br><span class="line">          sqLiteDatabase.execSQL(CreateTable_user);</span><br><span class="line">          sqLiteDatabase.execSQL(CreateTable_me);</span><br><span class="line">          Toast.makeText(myContext, <span class="string">"数据库创建成功"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当 version 中的值改变时，会调用这个方法，通过这个方法，删除原来的表，再调用onCreate()方法生成两个表</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase sqLiteDatabase, <span class="keyword">int</span> i, <span class="keyword">int</span> i1)</span> </span>&#123;</span><br><span class="line">           sqLiteDatabase.execSQL(<span class="string">"drop table if exists user"</span>);</span><br><span class="line">           sqLiteDatabase.execSQL(<span class="string">"drop table if exists clazz"</span>);</span><br><span class="line">           onCreate(sqLiteDatabase);</span><br><span class="line">           Toast.makeText(myContext, <span class="string">"成功"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="操作表"><a href="#操作表" class="headerlink" title="操作表"></a>操作表</h3><ul>
<li>添加数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过getWritableDatabase()获取SQLiteOpenHelper来操作数据库</span></span><br><span class="line">SQLiteDatabase database= base.getWritableDatabase();</span><br><span class="line">                ContentValues values=<span class="keyword">new</span> ContentValues();</span><br><span class="line">                values.put(<span class="string">"name"</span>,<span class="string">"小明"</span>);</span><br><span class="line">                values.put(<span class="string">"sex"</span>,<span class="string">"男"</span>);</span><br><span class="line">                values.put(<span class="string">"password"</span>,<span class="string">"12hjfgikldgislk"</span>);</span><br><span class="line">                values.put(<span class="string">"age"</span>,<span class="number">18</span>);</span><br><span class="line">                <span class="comment">//参数 1.表的名字 2.用于未指定添加数据的情况下给某些可为空的列自动赋值NULL </span></span><br><span class="line">                <span class="comment">//3. ContentValues 对象</span></span><br><span class="line">                database.insert(<span class="string">"user"</span>,<span class="keyword">null</span>,values);</span><br></pre></td></tr></table></figure>
<ul>
<li>更新数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase database= base.getWritableDatabase();</span><br><span class="line">                ContentValues values=<span class="keyword">new</span> ContentValues();</span><br><span class="line">                values.put(<span class="string">"name"</span>,<span class="string">"小军"</span>);  </span><br><span class="line">                <span class="comment">//后面的两个参数是操作的限制条件</span></span><br><span class="line">                database.update(<span class="string">"user"</span>,values,<span class="string">"age=?"</span>,<span class="keyword">new</span> String[]&#123;<span class="string">"18"</span>&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>删除数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase database= base.getWritableDatabase();</span><br><span class="line"><span class="comment">//后面的两个参数是操作的限制条件,用来约束删除哪几行，如果不指定就删除所有行</span></span><br><span class="line">database.delete(<span class="string">"user"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>查询数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase database=base.getWritableDatabase();</span><br><span class="line">Cursor cursor= database.query(<span class="string">"user"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (cursor.moveToFirst())&#123;</span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">        Log.d(<span class="string">"name:"</span>,cursor.getString(cursor.getColumnIndex(<span class="string">"name"</span>)));</span><br><span class="line">        Log.d(<span class="string">"age:"</span>,cursor.getString(cursor.getColumnIndex(<span class="string">"age"</span>)));</span><br><span class="line">        Log.d(<span class="string">"sex:"</span>,cursor.getString(cursor.getColumnIndex(<span class="string">"sex"</span>)));</span><br><span class="line">        Log.d(<span class="string">"password:"</span>,cursor.getString(cursor.getColumnIndex(<span class="string">"password"</span>)));</span><br><span class="line">    &#125;<span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line">&#125;</span><br><span class="line">cursor.close();</span><br></pre></td></tr></table></figure>
<p>query的参数如下：<br><img src="https://user-gold-cdn.xitu.io/2019/6/9/16b3cc545772bec2?w=1065&amp;h=310&amp;f=jpeg&amp;s=40933" alt></p>
<ul>
<li>使用sql直接对数据库进行操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQLiteDatabase database=base.getWritableDatabase();</span><br><span class="line">database.execSQL();</span><br><span class="line">database.rawQuery();<span class="comment">//只有查询数据的时候才调用这个方法</span></span><br></pre></td></tr></table></figure>
<h2 id="仿照LitePal实现一个简易的数据库框架SimpleDatabase"><a href="#仿照LitePal实现一个简易的数据库框架SimpleDatabase" class="headerlink" title="仿照LitePal实现一个简易的数据库框架SimpleDatabase"></a>仿照<code>LitePal</code>实现一个简易的数据库框架<code>SimpleDatabase</code></h2><h3 id="SimpleDatabase的使用"><a href="#SimpleDatabase的使用" class="headerlink" title="SimpleDatabase的使用"></a><code>SimpleDatabase</code>的使用</h3><ol>
<li>先在<code>asset</code>文件中创建<code>my_database.xml</code></li>
</ol>
<p><code>my_database.xml</code>如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">database</span> <span class="attr">name</span>=<span class="string">"test.db"</span> <span class="attr">version</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--class属性是数据表Bean的全路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"com.example.mylibrary.Employee"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><code>Employee</code>的源码如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">char</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(<span class="keyword">char</span> sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用id作为员工的唯一标识</span></span><br><span class="line">        <span class="keyword">return</span> Integer.toString(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意：<code>SimpleDatabase</code>通过<code>toString</code>来区别两个对象是否为同一对象，如<code>Employee</code>就使用<code>id</code>作为标识符。</p>
<ol start="2">
<li><p>在<code>AndroidManifest.xml</code>中加入<code>android:name=&quot;com.example.databaselibrary.MyApplication&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.databaselibrary.MyApplication"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>SimpleDatabase</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        SimpleDatabase.newInstance().create();<span class="comment">//初始化</span></span><br><span class="line">        </span><br><span class="line">         Employee employee =<span class="keyword">new</span> Employee();</span><br><span class="line">                employee.setId(<span class="number">1</span>);</span><br><span class="line">                employee.setName(<span class="string">"a"</span>);</span><br><span class="line">                employee.setSex(<span class="string">'男'</span>);</span><br><span class="line">                SimpleDatabase.saveAndUpdate(employee);</span><br><span class="line"></span><br><span class="line">                Employee employee1 =<span class="keyword">new</span> Employee();</span><br><span class="line">                employee1.setId(<span class="number">2</span>);</span><br><span class="line">                employee1.setName(<span class="string">"b"</span>);</span><br><span class="line">                employee1.setSex(<span class="string">'男'</span>);</span><br><span class="line">                SimpleDatabase.saveAndUpdate(employee1);</span><br><span class="line"></span><br><span class="line">                Employee employee2 =<span class="keyword">new</span> Employee();</span><br><span class="line">                employee2.setId(<span class="number">3</span>);</span><br><span class="line">                employee2.setName(<span class="string">"c"</span>);</span><br><span class="line">                employee2.setSex(<span class="string">'女'</span>);</span><br><span class="line">                SimpleDatabase.saveAndUpdate(employee2);</span><br><span class="line"></span><br><span class="line">                List&lt;Employee&gt; l=SimpleDatabase.select(Employee.class,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;l.size() ; i++) &#123;</span><br><span class="line">                    Employee e=l.get(i);</span><br><span class="line">                    Log.d(<span class="string">"==============="</span>,e.getName());</span><br><span class="line">                    Log.d(<span class="string">"==============="</span>,e.getSex()+<span class="string">""</span>);</span><br><span class="line">                    Log.d(<span class="string">"==============="</span>,e.getId()+<span class="string">""</span>);</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>首先读取配置信息，获取数据库和表的信息<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析xml文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String RESOURCES=<span class="string">"my_database.xml"</span>;<span class="comment">//配置数据库信息的xml名字</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TABLE=<span class="string">"table"</span>;<span class="comment">//xml属性常量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String VERSION=<span class="string">"version"</span>;<span class="comment">//xml属性常量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String DATABASE=<span class="string">"database"</span>;<span class="comment">//xml属性常量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String NAME=<span class="string">"name"</span>;<span class="comment">//xml属性常量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; map=<span class="keyword">null</span>;<span class="comment">//用来存储数据库信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tables=<span class="keyword">null</span>;<span class="comment">//用来存储表信息</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">XMLParser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        context=MyApplication.getContext();</span><br><span class="line">        map=<span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">        tables=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//解析数据</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">()</span> <span class="keyword">throws</span> IOException, XmlPullParserException </span>&#123;</span><br><span class="line"></span><br><span class="line">        XmlPullParserFactory factory=XmlPullParserFactory.newInstance();</span><br><span class="line"></span><br><span class="line">        XmlPullParser xmlPullParser=factory.newPullParser();</span><br><span class="line">       <span class="comment">//从asset文件下读取my_database.xml的信息</span></span><br><span class="line">        xmlPullParser.setInput(<span class="keyword">new</span> InputStreamReader(context.getAssets().open(RESOURCES)));</span><br><span class="line">        <span class="keyword">int</span> type=xmlPullParser.getEventType();</span><br><span class="line">        <span class="keyword">while</span>(type!=XmlPullParser.END_DOCUMENT)&#123;</span><br><span class="line">                <span class="keyword">if</span> (xmlPullParser.getEventType()==XmlResourceParser.START_TAG)&#123;<span class="comment">//如果为开始标签</span></span><br><span class="line">                    String name=xmlPullParser.getName();</span><br><span class="line">                    <span class="keyword">switch</span> (name)&#123;</span><br><span class="line">                        <span class="keyword">case</span> DATABASE:<span class="comment">//标签为&lt;database&gt;</span></span><br><span class="line">                            parseDatabase(xmlPullParser);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TABLE:<span class="comment">//标签为&lt;table&gt;</span></span><br><span class="line">                            parseTable(xmlPullParser);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                xmlPullParser.next();<span class="comment">//下一个标签</span></span><br><span class="line">                type=xmlPullParser.getEventType();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析数据库信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseDatabase</span><span class="params">(XmlPullParser xmlPullParser)</span>  </span>&#123;</span><br><span class="line">        String databaseName=<span class="keyword">null</span>;</span><br><span class="line">        String version=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (xmlPullParser.getAttributeCount()==<span class="number">2</span>)&#123;</span><br><span class="line">            String value_1=xmlPullParser.getAttributeName(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (NAME.equals(value_1))&#123;</span><br><span class="line">                databaseName=xmlPullParser.getAttributeValue(<span class="number">0</span>);</span><br><span class="line">                version=xmlPullParser.getAttributeValue(<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                databaseName=xmlPullParser.getAttributeValue(<span class="number">1</span>);</span><br><span class="line">                version=xmlPullParser.getAttributeValue(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"database标签的参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(DATABASE,databaseName);</span><br><span class="line">        map.put(VERSION,version);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析表格信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseTable</span><span class="params">(XmlPullParser xmlPullParser)</span> </span>&#123;</span><br><span class="line">        String className=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (xmlPullParser.getAttributeCount()==<span class="number">1</span>)&#123;</span><br><span class="line">            className=xmlPullParser.getAttributeValue(<span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"table参数错误"</span>);</span><br><span class="line">        tables.add(className);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getTables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tables;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建数据库的类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDatabase</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> onDatabaseUpdateListener listener=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyDatabase"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDatabase</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version,onDatabaseUpdateListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, name, factory, version);</span><br><span class="line">        <span class="keyword">this</span>.listener=listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        String[] createTables = listener.onCreate();</span><br><span class="line">            <span class="keyword">for</span> (String s: createTables)&#123;</span><br><span class="line">                db.execSQL(s);</span><br><span class="line">                Log.d(<span class="string">"======建表语句"</span>,s);</span><br><span class="line">            &#125;</span><br><span class="line">        Log.d(<span class="string">"======"</span>,<span class="string">"onCreate执行"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line">        String[] deleteTable = listener.update(db);</span><br><span class="line">        Log.d(<span class="string">"======"</span>,<span class="string">"onUpgrade执行"</span>);</span><br><span class="line">           <span class="keyword">if</span> (deleteTable !=<span class="keyword">null</span>)&#123;</span><br><span class="line">               <span class="keyword">for</span> (String s: deleteTable)&#123;</span><br><span class="line">                   db.execSQL(s);</span><br><span class="line">                   Log.d(<span class="string">"=====删表语句"</span>,s);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           onCreate(db);</span><br><span class="line">           listener.onCreateLater(db);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">onDatabaseUpdateListener</span></span>&#123;</span><br><span class="line">        String[] update(SQLiteDatabase db);<span class="comment">//数据库版本更新时调用</span></span><br><span class="line">        String[] onCreate();<span class="comment">//创建新的表时调用</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span>  <span class="title">onCreateLater</span><span class="params">(SQLiteDatabase db)</span></span>;<span class="comment">//创建完表时调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>完成数据库操作的实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现数据的操作和数据库的创建</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDatabase</span> <span class="keyword">implements</span> <span class="title">MyDatabase</span>.<span class="title">onDatabaseUpdateListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String NAME=<span class="string">"SimpleDatabase.xml"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String OLD=<span class="string">"old"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TABLE=<span class="string">"table_"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String NUMBER=<span class="string">"number"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//MyDatabaseHelper是一个辅助类，用来生成创建数据库和表所需要的数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyDatabaseHelper databaseHelper=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SQLiteDatabase db=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Map&lt;String,Cursor&gt; savedData=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    String simpleNames[]=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SimpleDatabase"</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SimpleDatabase simpleDatabase=<span class="keyword">new</span> SimpleDatabase();</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">SimpleDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">       init();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">       databaseHelper=<span class="keyword">new</span> MyDatabaseHelper();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询指定的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; List&lt;T&gt; <span class="title">select</span><span class="params">(Class&lt;T&gt; clazz,String columnNames[],String where,</span></span></span><br><span class="line"><span class="function"><span class="params">                                String args[],String groupBy, String having, String orderBy)</span></span>&#123;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Cursor cursor= db.query(clazz.getSimpleName(),columnNames,where,args,groupBy,having,orderBy);</span><br><span class="line">        <span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                T t = clazz.newInstance();</span><br><span class="line">                Field fields[]=clazz.getDeclaredFields();</span><br><span class="line">                <span class="keyword">for</span> (Field f:fields) &#123;</span><br><span class="line">                        f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                        String fieldName = f.getName();</span><br><span class="line">                        String fieldValue = cursor.getColumnName(cursor.getColumnIndex(fieldName));</span><br><span class="line">                        <span class="comment">//由于getColumnName（）只会返回String类型，所以这里需要getInitialTypeValue()</span></span><br><span class="line">                        <span class="comment">//获取初始类型的值</span></span><br><span class="line">                        f.set(t,getInitialTypeValue(f.getType().getSimpleName(),fieldValue));</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(t);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cursor.close();</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title">getInitialTypeValue</span><span class="params">(String type,String value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"int"</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"integer"</span>:</span><br><span class="line">                <span class="keyword">return</span> Integer.valueOf(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"boolean"</span>:</span><br><span class="line">                <span class="keyword">return</span> Boolean.valueOf(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"float"</span>:</span><br><span class="line">                <span class="keyword">return</span> Float.valueOf(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"double"</span>:</span><br><span class="line">                <span class="keyword">return</span> Double.valueOf(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"String"</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Character"</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"char"</span>:</span><br><span class="line">               <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询指定的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Cursor <span class="title">select</span><span class="params">(Object obj,String columnNames[],String where,String args[])</span></span>&#123;</span><br><span class="line">       String tableName=obj.getClass().getSimpleName();</span><br><span class="line">       <span class="keyword">return</span> db.query(tableName,columnNames,where,args,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果不存在数据库就创建，如果已经存在，则直接结束</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">()</span></span>&#123;</span><br><span class="line">       String name=databaseHelper.getName();</span><br><span class="line">       String version=databaseHelper.getVersion();</span><br><span class="line">       <span class="keyword">if</span> (databaseHelper.check(getOldVersion(),Integer.valueOf(version)))<span class="comment">//如果需要更新</span></span><br><span class="line">           saveDataInSharedPreferences(Integer.valueOf(version));</span><br><span class="line">       Log.d(<span class="string">"========="</span>,<span class="string">"name"</span>+name);</span><br><span class="line">       MyDatabase database = <span class="keyword">new</span> MyDatabase(MyApplication.getContext(), name, <span class="keyword">null</span>, Integer.valueOf(version), SimpleDatabase.<span class="keyword">this</span>);</span><br><span class="line">       db= database.getWritableDatabase();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleDatabase <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> simpleDatabase;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储批量数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(List&lt;Object&gt; list)</span>  </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (Object o:list) &#123;</span><br><span class="line">           save(o);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储单个数据到表中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Object o)</span>  </span>&#123;</span><br><span class="line">           Class clazz=o.getClass();</span><br><span class="line">           Field fields[]=clazz.getDeclaredFields();</span><br><span class="line">           ContentValues values=<span class="keyword">new</span> ContentValues();</span><br><span class="line">           values.put(<span class="string">"simple_database_id"</span>,o.toString());</span><br><span class="line">           <span class="keyword">for</span> (Field f:fields) &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                      f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                      <span class="keyword">if</span> (f.get(o)!=<span class="keyword">null</span>&amp;&amp;!<span class="string">"serialVersionUID"</span>.equals(f.getName())) &#123;</span><br><span class="line">                          values.put(f.getName(), f.get(o).toString());</span><br><span class="line">                          Log.d(<span class="string">"========value"</span>, f.get(o).toString());</span><br><span class="line">                      &#125;</span><br><span class="line">               &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                   Log.wtf(TAG,<span class="string">"类中所以的数据应该设置值"</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           db.insert(clazz.getSimpleName(),<span class="keyword">null</span>,values);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveAndUpdate</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">       Class clazz=o.getClass();</span><br><span class="line">       String id=o.toString();</span><br><span class="line">       Field fields[]=clazz.getDeclaredFields();</span><br><span class="line">       ContentValues values=<span class="keyword">new</span> ContentValues();</span><br><span class="line">       values.put(<span class="string">"simple_database_id"</span>,o.toString());</span><br><span class="line">       <span class="keyword">for</span> (Field f:fields) &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               f.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">               <span class="keyword">if</span> (f.get(o)!=<span class="keyword">null</span>&amp;&amp;!<span class="string">"serialVersionUID"</span>.equals(f.getName())) &#123;</span><br><span class="line">                   values.put(f.getName(), f.get(o).toString());</span><br><span class="line">                   Log.d(<span class="string">"========value"</span>, f.get(o).toString());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">               Log.wtf(TAG,<span class="string">"类中所以的数据应该设置值"</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       Cursor cursor=select(o,<span class="keyword">null</span>,<span class="string">"simple_database_id=?"</span>,<span class="keyword">new</span> String[]&#123;id&#125;);</span><br><span class="line">       <span class="keyword">if</span> (cursor.getCount()==<span class="number">0</span>)&#123;<span class="comment">//插入</span></span><br><span class="line">           db.insert(clazz.getSimpleName(),<span class="keyword">null</span>,values);</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;<span class="comment">//更新</span></span><br><span class="line">           db.update(clazz.getSimpleName(),values,<span class="string">"simple_database_id=?"</span>,<span class="keyword">new</span> String[]&#123;id&#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除表中所有的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">       Class clazz=o.getClass();</span><br><span class="line">       delete(clazz.getSimpleName(),<span class="string">"simple_database_id=?"</span>,o.toString());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除表中指定的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> where</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String name,String where,String... arg)</span></span>&#123;</span><br><span class="line">       db.delete(name,where,arg);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果版本更新，则存储最新的版本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> version 版本号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveDataInSharedPreferences</span><span class="params">(<span class="keyword">int</span> version)</span></span>&#123;</span><br><span class="line">       <span class="comment">//获取SharedPreferences的Editor对象来执行储存操作</span></span><br><span class="line">       SharedPreferences.Editor editor=MyApplication.getContext().getSharedPreferences(NAME,<span class="number">0</span>).edit();</span><br><span class="line">       editor.putInt(OLD,version);</span><br><span class="line">       editor.apply();<span class="comment">//最后一定要调用这个方法，完成数据的储存</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *存储过去的表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> names</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveDataInSharedPreferences</span><span class="params">(String[] names)</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取SharedPreferences的Editor对象来执行储存操作</span></span><br><span class="line">        SharedPreferences.Editor editor=MyApplication.getContext().getSharedPreferences(NAME,<span class="number">0</span>).edit();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;names.length;i++)&#123;</span><br><span class="line">            editor.putString(TABLE+i,names[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        editor.putInt(NUMBER,names.length);</span><br><span class="line">        editor.apply();<span class="comment">//最后一定要调用这个方法，完成数据的储存</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取上一次的数据库的版本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getOldVersion</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SharedPreferences get=MyApplication.getContext().getSharedPreferences(NAME,<span class="number">0</span>);</span><br><span class="line">       <span class="keyword">return</span> get.getInt(OLD,<span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] getOldTableName()&#123;</span><br><span class="line">        SharedPreferences get=MyApplication.getContext().getSharedPreferences(NAME,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">int</span> length=get.getInt(NUMBER,-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (length==-<span class="number">1</span>)</span><br><span class="line">            Log.wtf(TAG,<span class="string">"原有表格不存在"</span>);</span><br><span class="line">        String names[]=<span class="keyword">new</span> String[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;length;i++)&#123;</span><br><span class="line">            names[i]=get.getString(TABLE+i,<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> names;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] update(SQLiteDatabase db) &#123;<span class="comment">//在删除表之前把表的数据保存起来</span></span><br><span class="line">        simpleNames=getOldTableName();</span><br><span class="line">        savedData=<span class="keyword">new</span> HashMap&lt;&gt;(simpleNames.length);</span><br><span class="line">        <span class="keyword">for</span> (String name:simpleNames) &#123;</span><br><span class="line">            Cursor cursor=db.query(name,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">            savedData.put(name,cursor);</span><br><span class="line">        &#125;</span><br><span class="line">        Cursor cursor=savedData.get(simpleNames[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst())&#123;</span><br><span class="line">            String sex=cursor.getString(cursor.getColumnIndex(<span class="string">"sex"</span>));</span><br><span class="line">            Log.d(<span class="string">"===============update"</span>,<span class="string">"sex="</span>+sex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> databaseHelper.getDeleteTable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] onCreate() &#123;</span><br><span class="line">        saveDataInSharedPreferences(databaseHelper.getSimpleTableName());</span><br><span class="line">        <span class="keyword">return</span> databaseHelper.getCreateTable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreateLater</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        recoverAllData(db);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 恢复所有的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recoverAllData</span><span class="params">(SQLiteDatabase db)</span></span>&#123;</span><br><span class="line">       List&lt;String&gt; deleteTable=checkWhichTableDisappear(databaseHelper.getTables());</span><br><span class="line">       List&lt;String&gt; nowTable=Arrays.asList(simpleNames);</span><br><span class="line">       nowTable.remove(deleteTable);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nowTable.size();i++)&#123;</span><br><span class="line">          Cursor cursor=savedData.get(nowTable.get(i));</span><br><span class="line">          ContentValues values=<span class="keyword">new</span> ContentValues();</span><br><span class="line">           <span class="keyword">if</span> (cursor.moveToFirst())&#123;</span><br><span class="line">               <span class="keyword">do</span>&#123;</span><br><span class="line">                   String columnNames[]=cursor.getColumnNames();</span><br><span class="line">                   <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;columnNames.length;j++)</span><br><span class="line">                         values.put(columnNames[j],cursor.getString(cursor.getColumnIndex(columnNames[j])));</span><br><span class="line">               &#125;<span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line">               db.insert(nowTable.get(i),<span class="keyword">null</span>,values);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">for</span> (String n:simpleNames) &#123;<span class="comment">//释放所有的资源</span></span><br><span class="line">            savedData.get(n).close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查有哪些表被删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newTable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">checkWhichTableDisappear</span><span class="params">(List&lt;String&gt; newTable)</span></span>&#123;</span><br><span class="line">            String deleteTable[]=<span class="keyword">new</span> String[simpleNames.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;simpleNames.length;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (!newTable.contains(simpleNames[i]))&#123;</span><br><span class="line">                    deleteTable[j]=simpleNames[i];</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">return</span> Arrays.asList(deleteTable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>SimpleDatabase</code>的主要作用是在<code>my_database.xml</code>中的配置更改时，能自动更新数据库；插入和更新时，通过<code>saveAndUpdate(Object o)</code>使用对象来实现插入和更新操作（当数据库中不存在同一条数据时，就插入；当数据库中存在同一条数据时，就更新）；查询时，通过</p>
<p><code>List&lt;T&gt; select(Class&lt;T&gt; clazz,String columnNames[],String where,String args[],String groupBy, String having, String orderBy)</code>获取包含查询结果对象的集合；删除时，通过<code>delete(Object o)</code>使用对象来实现删除操作。</p>
<p>实现原理：</p>
<p><code>SimpleDatabase</code>通过实现<code>MyDatabase</code>的<code>onDatabaseUpdateListener</code>接口，监听<code>MyDatabase</code>的<code>onCreate</code>和<code>onUpgrade</code>方法。在<code>onCreate</code>被调用时，调用<code>onDatabaseUpdateListener.onCreate</code>来存储之前的表名（如果修改了配置文件的话），并返回创建表的sql语句集合（可能创建多个表），之后在<code>MyDatabase.onCreate</code>中创建表。当<code>onUpgrade</code>被调用时，调用<code>onDatabaseUpdateListener.update</code>来存储当前数据库中的数据，并返回删除表的sql语句集合，删除成功后创建新的表，之后调用<code>onDatabaseUpdateListener.onCreateLater</code>方法将之前存储的数据重新存储到数据库中。</p>
<p><code>SimpleDatabase</code>中的<code>select</code>、<code>delete</code>、<code>saveAndUpdate</code>方法是通过反射实现的，具体可以看注释。</p>
<p>其他类的实现很简单，具体可以看源码：</p>
<ul>
<li><p>MyApplication类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取系统的context</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Context context;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        context = getApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">getContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MyDatabaseHelper类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成创建数据库和表所需要的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDatabaseHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String version=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tables=<span class="keyword">null</span>;<span class="comment">//存储完整类名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Table[]&gt; maps=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createTable[]=<span class="keyword">null</span>;<span class="comment">//存储建表语句</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String deleteTable[]=<span class="keyword">null</span>;<span class="comment">//存储删除表的语句</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> ok=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyDatabaseHelper"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDatabaseHelper</span><span class="params">()</span></span>&#123;</span><br><span class="line">       init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        XMLParser xmlParser=<span class="keyword">null</span>;</span><br><span class="line">        xmlParser=<span class="keyword">new</span> XMLParser();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            xmlParser.parse();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | XmlPullParserException  e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        name=xmlParser.getMap().get(XMLParser.DATABASE);</span><br><span class="line">        version=xmlParser.getMap().get(XMLParser.VERSION);</span><br><span class="line">        tables=xmlParser.getTables();</span><br><span class="line">        maps=<span class="keyword">new</span> HashMap&lt;&gt;(tables.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查是否需要更新</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> old 之前的版本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> now 现在的版本</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> old,<span class="keyword">int</span> now)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (now&gt;old) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                parseTable();</span><br><span class="line">                ok=<span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析类的数据,在version改变时调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseTable</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String name:tables)&#123;</span><br><span class="line">            Class table=Class.forName(name);</span><br><span class="line">            Field[] field=table.getDeclaredFields();</span><br><span class="line">            Table info[]=<span class="keyword">new</span> Table[field.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;field.length;i++)&#123;</span><br><span class="line">                Table t=<span class="keyword">new</span> Table();</span><br><span class="line">                t.setProperty(field[i].getName());</span><br><span class="line">                t.setType(field[i].getType().getSimpleName());</span><br><span class="line">                info[i]=t;</span><br><span class="line">            &#125;</span><br><span class="line">            maps.put(name,info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成建表语句</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">generateTable</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tables.size();i++)&#123;</span><br><span class="line">            Table table[]=maps.get(tables.get(i));</span><br><span class="line">            StringBuilder stringBuilder=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">            String simpleName=getSimpleName(tables.get(i));</span><br><span class="line">            stringBuilder.append(<span class="string">"create table "</span>+simpleName+<span class="string">"( "</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;table.length;j++)&#123;</span><br><span class="line">                Table t=table[j];</span><br><span class="line">                <span class="keyword">if</span> (t!=<span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">if</span> (!Table.OTHER.equals(t.getType()))</span><br><span class="line">                    stringBuilder.append(<span class="string">" , "</span>+t.getProperty()+<span class="string">" "</span>+t.getType());</span><br><span class="line">            &#125;</span><br><span class="line">            String string=stringBuilder.append(<span class="string">")"</span>).toString();</span><br><span class="line">            string=string.replaceFirst(<span class="string">","</span>,<span class="string">""</span>);</span><br><span class="line">            createTable[i]=string;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成删除表的语句</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">            deleteTable[i]=<span class="string">"drop table if exists "</span>+getSimpleName(tables.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取简单类名，不包括包</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 带有包名的类名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 不包含包名的类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getSimpleName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> position= name.lastIndexOf(<span class="string">'.'</span>);</span><br><span class="line">       <span class="keyword">return</span> name.substring(position+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> version;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getCreateTable() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!ok)</span><br><span class="line">            Log.e(TAG,<span class="string">"必须先调用check()"</span>);</span><br><span class="line">        createTable=<span class="keyword">new</span> String[tables.size()];</span><br><span class="line">        generateTable();</span><br><span class="line">        <span class="keyword">return</span> createTable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getDeleteTable() &#123;</span><br><span class="line">        <span class="keyword">if</span> (!ok)</span><br><span class="line">            Log.e(TAG,<span class="string">"必须先调用check()"</span>);</span><br><span class="line">        deleteTable=<span class="keyword">new</span> String[tables.size()];</span><br><span class="line">        deleteTable();</span><br><span class="line">        <span class="keyword">return</span> deleteTable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getTables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tables;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getSimpleTableName() &#123;</span><br><span class="line"></span><br><span class="line">        String simpleTableName[]=<span class="keyword">new</span> String[tables.size()];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tables.size();i++) &#123;</span><br><span class="line"></span><br><span class="line">            String simpleName = getSimpleName(tables.get(i));</span><br><span class="line"></span><br><span class="line">            simpleTableName[i] = simpleName;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> simpleTableName;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MyException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Table类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存储每个字段对应的属性和名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String INTEGER=<span class="string">"integer"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String TEXT=<span class="string">"text"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String REAL=<span class="string">"real"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String BLOB=<span class="string">"blob"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String INT=<span class="string">"int"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String CHAR=<span class="string">"char"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String FLOAT=<span class="string">"float"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String DOUBLE=<span class="string">"double"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String STRING=<span class="string">"String"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String BOOLEAN=<span class="string">"boolean"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> String OTHER=<span class="string">"other"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String property;<span class="comment">//对应的属性</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;<span class="comment">//对应的属性的类型</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> property;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(String property)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.property = property;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        checkProperty(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkProperty</span><span class="params">(String property)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (property)&#123;</span><br><span class="line">            <span class="keyword">case</span> INT:</span><br><span class="line">            <span class="keyword">case</span> BOOLEAN:</span><br><span class="line">                type=INTEGER;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> FLOAT:</span><br><span class="line">            <span class="keyword">case</span> DOUBLE:</span><br><span class="line">                type=REAL;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STRING:</span><br><span class="line">            <span class="keyword">case</span> CHAR:</span><br><span class="line">                type=TEXT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                 type=OTHER;</span><br><span class="line">                 <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>参考<a href="https://www.runoob.com/sqlite/sqlite-tutorial.html" target="_blank" rel="noopener">菜鸟教程</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/05/TCP-IP的学习总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/05/TCP-IP的学习总结/" itemprop="url">TCP/IP的学习总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-05T23:57:29+08:00">
                2019-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/计算机网络/" itemprop="url" rel="index">
                    <span itemprop="name">计算机网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章是自己所学的《计算机网络》这门课程的总结，如果有任何错误欢迎指正。</p>
<h2 id="TCP-IP模型"><a href="#TCP-IP模型" class="headerlink" title="TCP/IP模型"></a>TCP/IP模型</h2><p><img src="https://user-gold-cdn.xitu.io/2019/6/3/16b1df77fb4ec2f1?w=288&amp;h=357&amp;f=jpeg&amp;s=22376" alt><br>应用层：具体应用程序实现层<br><br>运输层：让应用程序之间实现通信<br><br>网络层（或网际层）：主要利用IP协议转发分包数据<br><br>网络接口层：TCP/IP对网络接口层未作定义<br></p>
<blockquote>
<p>网络层和运输层的功能通常由操作系统提供，一般通过操作系统的<code>Socket</code>接口</p>
</blockquote>
<h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><p>网络层中最重要的就是<code>IP协议</code>。如下图，通过IP协议可以实现在不同的网络中进行通信，而不用关系下层的网络接口层中所使用的协议。<br><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b1e223cf7953df?w=912&amp;h=531&amp;f=jpeg&amp;s=71275" alt></p>
<blockquote>
<p>IP协议是无连接的、尽最大努力交付的不可靠协议</p>
</blockquote>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><p>IP地址是IP协议用来识别不同主机的地址，类似于MAC地址。</p>
<h4 id="两级IP-地址"><a href="#两级IP-地址" class="headerlink" title="两级IP 地址"></a>两级IP 地址</h4><p><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b1e353c84adf86?w=950&amp;h=711&amp;f=jpeg&amp;s=90672" alt><br>net-id代表网络号，host-id代表主机号</p>
<h4 id="三级IP-地址"><a href="#三级IP-地址" class="headerlink" title="三级IP 地址"></a>三级IP 地址</h4><p>以A类地址为例，一个A类地址可以连<code>2^24</code>个主机，但是我只需要连接<code>2^20</code>个主机，而使用B类地址又不足，这种情况就造成了浪费；再加上IP地址快耗尽的问题，就出现了三级IP 地址。</p>
<p>如下图，通过从主机号借用若干个位作为子网号<code>subnet-id</code>，而主机号 <code>host-id</code>也就相应减少了若干个位。通过这种方式就可以对IP地址进行更精细地划分，从而减少IP地址地浪费。而且划分子网纯属一个单位内部的事情单位对外仍然表现为没有划分子网的网络，从而兼容以前的两级IP 地址。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b1e3f2f7b1c33e?w=798&amp;h=80&amp;f=png&amp;s=7382" alt></p>
<h4 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h4><p>通过子网掩码来获取IP地址中的子网部分，如图IP地址与子网掩码进行与运算得到子网的网络地址：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b1e4bc47b04102?w=991&amp;h=523&amp;f=jpeg&amp;s=72623" alt> </p>
<h4 id="无分类编址（CIDR）"><a href="#无分类编址（CIDR）" class="headerlink" title="无分类编址（CIDR）"></a>无分类编址（CIDR）</h4><p>由于IPv4的地址即将耗尽，就采用无分类编址（CIDR）消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，从而使用各种长度的“网络前缀”来代替分类地址中的网络号和子网号。</p>
<h3 id="网络层的其他协议"><a href="#网络层的其他协议" class="headerlink" title="网络层的其他协议"></a>网络层的其他协议</h3><h4 id="ICMP协议"><a href="#ICMP协议" class="headerlink" title="ICMP协议"></a>ICMP协议</h4><p>IP协议并不是一个可靠的协议，它不保证数据被送达，那么，自然的，保证数据送达的工作应该由其他的模块来完成。其中一个重要的模块就是ICMP(网络控制报文)协议。ICMP不是高层协议，而是IP层的协议。<br><br>当传送IP数据包发生错误。比如主机不可达，路由不可达等等，ICMP协议将会把错误信息封包，然后传送回给主机。给主机一个处理错误的机会，这 也就是为什么说建立在IP层以上的协议是可能做到安全的原因。</p>
<h4 id="RAP协议"><a href="#RAP协议" class="headerlink" title="RAP协议"></a>RAP协议</h4><p>RAP协议是通过目的IP地址来获取目的MAC地址的协议。</p>
<h3 id="IP协议数据报格式"><a href="#IP协议数据报格式" class="headerlink" title="IP协议数据报格式"></a>IP协议数据报格式</h3><p><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b1e5aa95112b88?w=1006&amp;h=519&amp;f=jpeg&amp;s=71243" alt></p>
<p>版本：IP协议的版本，占4位<br><br>生存时间（TTL）：数据报在网络中可通过的路由器数，IP数据包每穿过一个路由器，该数据包的TTL数值就会减少1，当该数据包的TTL成为零，它就会被自动抛弃。<br><br>协议：0x11代表UDP，0x06代表TCP</p>
<h2 id="运输层"><a href="#运输层" class="headerlink" title="运输层"></a>运输层</h2><h3 id="TCP与UDP的区别"><a href="#TCP与UDP的区别" class="headerlink" title="TCP与UDP的区别"></a>TCP与UDP的区别</h3><table>
<thead>
<tr>
<th></th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody>
<tr>
<td>可靠性</td>
<td>可靠</td>
<td>不可靠</td>
</tr>
<tr>
<td>连接性</td>
<td>面向连接</td>
<td>无连接</td>
</tr>
<tr>
<td>报文</td>
<td>面向字节流</td>
<td>面向报文</td>
</tr>
<tr>
<td>流量控制</td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td>堵塞控制</td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td>传播速度</td>
<td>慢</td>
<td>快</td>
</tr>
<tr>
<td>应用场景</td>
<td>对数据准确性要求高的场景</td>
<td>对数据效率要求高的，比如视频通话等。</td>
</tr>
</tbody>
</table>
<p>面向报文和面向字节流的区别：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b21564f75f9a1d?w=1033&amp;h=494&amp;f=jpeg&amp;s=63354" alt><br>如图，面向报文的传输方式是应用层交给UDP多长的报文，UDP发送多长的报文，即一次发送一个报文。因此，应用程序必须选择合适大小的报文。若报文太长，则IP层需要分片，降低效率；若太短，会使IP数据报太小。<br><br><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b215688cab0e57?w=962&amp;h=543&amp;f=jpeg&amp;s=87968" alt><br>如图，面向字节流的话，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序看成是一连串的无结构的字节流。TCP有一个缓冲，当应用程序传送的数据块太长，TCP就可以把它划分短一些再传送。</p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><h4 id="三次握手和四次挥手"><a href="#三次握手和四次挥手" class="headerlink" title="三次握手和四次挥手"></a>三次握手和四次挥手</h4><p>TCP是面向连接的运输层协议，因此需要先建立连接，在进行数据传输。TCP建立连接的方式是三次握手，而切断连接是通过四次挥手。<br><img src="https://user-gold-cdn.xitu.io/2019/6/4/16b21624e545268d?w=873&amp;h=569&amp;f=png&amp;s=48437" alt="三次握手和四次挥手"></p>
<p>为什么要三次握手？</p>
<p><strong>为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误。</strong><br><br>具体例子——“已失效的连接请求报文段”的产生在这样一种情况下：<br></p>
<p>客户端发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达服务器。</p>
<p>本来这是一个早已失效的报文段。但服务器收到此失效的连接请求报文段后，就误认为是客户端再次发出的一个新的连接请求。于是就向客户端发出确认报文段，同意建立连接。<br></p>
<p>假设不采用“三次握手”，那么只要服务器发出确认，新的连接就建立了。由于现在客户端并没有发出建立连接的请求，因此不会理睬服务器的确认，也不会向服务器发送数据。但服务器却以为新的运输连接已经建立，并一直等待客户端发来数据。这样，服务器的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。<br><br>例如刚才那种情况，客户端不会向服务器的确认发出确认。服务器由于收不到确认，就知道客户端并没有要求建立连接。”<br><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b236274ab59fd5?w=1002&amp;h=769&amp;f=jpeg&amp;s=116683" alt><br>为什么要四次分手？</p>
<p>TCP协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。TCP是全双工模式，这就意味着，当主机1发出FIN报文段时，只是表示主机1已经没有数据要发送了，主机1告诉主机2，它的数据已经全部发送完毕了；</p>
<p>但是，这个时候主机1还是可以接受来自主机2的数据；当主机2返回ACK报文段时，表示它已经知道主机1没有数据发送了，但是主机2还是可以发送数据到主机1的；当主机2也发送了FIN报文段时，这个时候就表示主机2也没有数据要发送了，就会告诉主机1，我也没有数据要发送了，之后彼此就会愉快的中断这次TCP连接。</p>
<p>为什么要等待2MSL？</p>
<ul>
<li>保证TCP协议的全双工连接能够可靠关闭</li>
<li>保证这次连接的重复数据段从网络中消失<blockquote>
<p>MSL：报文段最大生存时间，它是任何报文段被丢弃前在网络内的最长时间。</p>
</blockquote>
</li>
</ul>
<p>转载<a href="https://lrh1993.gitbooks.io/android_interview_guide/content/computer-networks/tcpip.html" target="_blank" rel="noopener">TCP/IP · Android校招面试指南</a></p>
<h4 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h4><p>流量控制(flow control)就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。<br>利用滑动窗口机制可以很方便地在 TCP 连接上实现流量控制。</p>
<blockquote>
<p>滑动窗口机制:滑动窗口机制就是发送方和接收方各自维护一个发送窗口和接受窗口。当网络堵塞时，接收方可以减小接受窗口的大小，同时在确定报文中设置发送窗口的大小，当发送方接受到确定报文时，可以减小发送窗口的大小，从而减少发送速率。同理，当网络通畅时，可以提高发送速率。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b2363e5e931a0b?w=1023&amp;h=761&amp;f=jpeg&amp;s=156549" alt><br>TCP为每一个连接设有一个持续计时器(persistence timer)。当TCP连接中的发送方收到接收方的零窗口通知时（即rwnd=0时），发送方就启动持续计时器。若持续计时器设置的时间到期，发送方就发送一个零窗口控测报文段（携1字节的数据）给接收方。如果接收方可以接收数据，就重新开始发送数据；如果接收方不能接收数据，就重新设置持续计时器。</p>
<h4 id="堵塞控制"><a href="#堵塞控制" class="headerlink" title="堵塞控制"></a>堵塞控制</h4><p>在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏，就产生拥塞</p>
<blockquote>
<p>堵塞控制和流量控制的区别?</p>
<ul>
<li>拥塞控制是一个全局性的过程，涉及到所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素。 </li>
<li>流量控制往往指在给定的发送端和接收端之间的点对点通信量的控制。流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。 </li>
</ul>
</blockquote>
<p>堵塞控制的方法：</p>
<ol>
<li>慢开始和拥塞避免</li>
<li>快重传和快恢复</li>
</ol>
<h5 id="慢开始和拥塞避免"><a href="#慢开始和拥塞避免" class="headerlink" title="慢开始和拥塞避免"></a>慢开始和拥塞避免</h5><p>发送方维护一个叫做拥塞窗口的状态变量。拥塞窗口的大小取决于网络的拥塞程度，并且动态地在变化。<br>发送方控制拥塞窗口的原则是：只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去。但只要网络出现拥塞，拥塞窗口就减小一些，以减少到网络中的分组数。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b23653a884d4ee?w=1027&amp;h=765&amp;f=jpeg&amp;s=107646" alt></p>
<p>如上图，慢开始算法：</p>
<p><strong>使用慢开始算法后，每经过一个传输轮次，拥塞窗口 cwnd 就加倍。</strong><br>一个传输轮次所经历的时间其实就是往返时间 <code>RTT</code>。传输轮次更加强调：把拥塞窗口 cwnd 所允许发送的报文段都连续发送出去，并收到了对已发送的最后一个字节的确认。<br>例如，拥塞窗口 <code>cwnd</code> = 4，这时的往返时间 <code>RTT</code> 就是发送方连续发送 4 个报文段，并收到这 4 个报文段的确认，总共经历的时间。</p>
<p>拥塞避免算法</p>
<p>拥塞窗口 cwnd 缓慢地增大，即每经过一个往返时间 <code>RTT</code> 就把发送方的拥塞窗口 <code>cwnd</code> 加 1，而不是加倍，使拥塞窗口 <code>cwnd</code> 按线性规律缓慢增长。</p>
<p>由于指数爆炸的性质，就必须设置慢开始的门限 <code>ssthresh</code> ，其用法如下：</p>
<ol>
<li>当 <code>cwnd</code> &lt; <code>ssthresh</code> 时，使用慢开始算法。</li>
<li>当 <code>cwnd</code> &gt; <code>ssthresh</code> 时，停止使用慢开始算法而改用拥塞避免算法。</li>
<li>当 <code>cwnd</code> = <code>ssthresh</code> 时，既可使用慢开始算法，也可使用拥塞避免算法。</li>
</ol>
<p>无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（其根据就是没有按时收到确认），就要把慢开始门限 <code>ssthresh</code> 设置为出现拥塞时的发送方窗口值的一半（但不能小于2）。<br>然后把拥塞窗口 cwnd 重新设置为 1，执行慢开始算法。<br>这样做的目的就是要迅速减少主机发送到网络中的分组数，使得发生拥塞的路由器有足够时间把队列中积压的分组处理完毕。如下图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b23737ac31fac0?w=1027&amp;h=589&amp;f=jpeg&amp;s=71782" alt></p>
<h5 id="快重传和快恢复"><a href="#快重传和快恢复" class="headerlink" title="快重传和快恢复"></a>快重传和快恢复</h5><p>快重传算法首先要求接收方每收到一个失序的报文段后就立即发出重复确认。这样做可以让发送方及早知道有报文段没有到达接收方。<br>发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段。<br>不难看出，快重传并非取消重传计时器，而是在某些情况下可更早地重传丢失的报文段。如下图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b236e646aca6fc?w=964&amp;h=696&amp;f=jpeg&amp;s=89967" alt></p>
<p>快恢复</p>
<ol>
<li>当发送端收到连续三个重复的确认时，就执行“乘法减小”算法，把慢开始门限 ssthresh 减半。但接下去不执行慢开始算法。 </li>
<li>由于发送方现在认为网络很可能没有发生拥塞，因此现在不执行慢开始算法，即拥塞窗口 cwnd 现在不设置为 1，而是设置为慢开始门限 ssthresh 减半后的数值，然后开始执行拥塞避免算法（“加法增大”），使拥塞窗口缓慢地线性增大。</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/5/16b236df9efc1e24?w=997&amp;h=463&amp;f=jpeg&amp;s=75034" alt></p>
<blockquote>
<p>注意<strong>发送方的发送窗口的上限值</strong>应当取为接收方窗口 <code>rwnd</code> 和拥塞窗口 <code>cwnd</code> 这两个变量中较小的一个<br><br>当 <code>rwnd &lt; cwnd</code>时，是接收方的接收能力限制发送窗口的最大值。<br><br>当 <code>cwnd &lt; rwnd</code>时，则是网络的拥塞限制发送窗口的最大值。 </p>
</blockquote>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h2><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>DNS 是一个 域名 和 IP 相互映射的分布式数据库，通过DNS我们就可以通过域名更方便的访问互联网<br>详细的见<a href="https://juejin.im/post/59c6201df265da064428b835" target="_blank" rel="noopener">DNS基础知识</a></p>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>HTTP是超文本传输协议，用于客户端和服务器端之间的通信，属于TCP/IP中的应用层。<br>详细的见见<a href="https://juejin.im/post/5cd16ba251882541cc70cbf8" target="_blank" rel="noopener">《图解HTTP》核心知识总结</a></p>
<p>参考资料：</p>
<ul>
<li><a href="https://lrh1993.gitbooks.io/android_interview_guide/content/computer-networks/tcpip.html" target="_blank" rel="noopener">TCP/IP · Android校招面试指南</a></li>
<li>《计算机网络》</li>
<li>《图解TCP/IP》</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/29/Android应用之间数据的交互-获取系统应用的数据/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/29/Android应用之间数据的交互-获取系统应用的数据/" itemprop="url">Android应用之间数据的交互-获取系统应用的数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-29T23:57:07+08:00">
                2019-05-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Android应用开发中我们常常需要和其他应用进行交互，之前对这些问题没有仔细了解过，现在来做一下总结。</p>
<p>Android应用之间数据的交互方式：</p>
<ul>
<li>获取系统应用的数据</li>
<li>提供数据给其他应用</li>
<li>应用之间的分享</li>
</ul>
<p>下面介绍获取系统应用的数据</p>
<h2 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h2><p>以获取联系人数据为例，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Cursor cursor=getContentResolver().query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line"> <span class="keyword">if</span> (cursor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">     <span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">         <span class="comment">//获取联系人的名字</span></span><br><span class="line">         String name=cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME));</span><br><span class="line">         <span class="comment">//获取联系人的电话号码</span></span><br><span class="line">         String number=cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER));</span><br><span class="line">         Log.d(<span class="string">"============"</span>,<span class="string">" name: "</span>+name+<span class="string">"  number="</span>+number);</span><br><span class="line">     &#125;</span><br><span class="line">     cursor.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ContentResolver</code>类的<code>query(Uri uri,String[] projection,String selection,String[] selectionArgs,String sortOrder)</code>方法参数的介绍：<br><br><code>uri</code>用来指明要访问的数据的位置<br><br><code>projection</code>访问的列，如果为null，则表示访问所有列<br><br><code>selection</code>用于指定查询条件<br><br><code>selectionArgs</code>查询参数<br><br><code>sortOrder</code>排序顺序<br></p>
</blockquote>
<h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><p>那么<code>ContentResolver</code>是怎么通过<code>query</code>方法来获取联系人的数据的呢？下面我们来分析<code>ContentResolver</code>的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> <span class="function">Cursor <span class="title">query</span><span class="params">(@RequiresPermission.Read @NonNull Uri uri,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable String[] projection, @Nullable String selection,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable String[] selectionArgs, @Nullable String sortOrder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> query(uri, projection, selection, selectionArgs, sortOrder, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> <span class="function">Cursor <span class="title">query</span><span class="params">(@RequiresPermission.Read @NonNull Uri uri,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable String[] projection, @Nullable String selection,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable String[] selectionArgs, @Nullable String sortOrder,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable CancellationSignal cancellationSignal)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//把查询参数封装在Bundle中</span></span><br><span class="line">        Bundle queryArgs = createSqlQueryBundle(selection, selectionArgs, sortOrder);</span><br><span class="line">        <span class="keyword">return</span> query(uri, projection, queryArgs, cancellationSignal);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//3</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> <span class="function">Cursor <span class="title">query</span><span class="params">(<span class="keyword">final</span> @RequiresPermission.Read @NonNull Uri uri,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable String[] projection, @Nullable Bundle queryArgs,</span></span></span><br><span class="line"><span class="function"><span class="params">            @Nullable CancellationSignal cancellationSignal)</span> </span>&#123;</span><br><span class="line">        Preconditions.checkNotNull(uri, <span class="string">"uri"</span>);</span><br><span class="line">        <span class="comment">//获取不稳定的提供者 IContentProvider是IPC接口用来与内容提供者进行数据交互</span></span><br><span class="line">        IContentProvider unstableProvider = acquireUnstableProvider(uri);</span><br><span class="line">        <span class="keyword">if</span> (unstableProvider == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        IContentProvider stableProvider = <span class="keyword">null</span>;</span><br><span class="line">        Cursor qCursor = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...<span class="comment">//省略些不重要的源码</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                qCursor = unstableProvider.query(mPackageName, uri, projection,</span><br><span class="line">                        queryArgs, remoteCancellationSignal);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (DeadObjectException e) &#123;</span><br><span class="line">                <span class="comment">// The remote process has died...  but we only hold an unstable</span></span><br><span class="line">                <span class="comment">// reference though, so we might recover!!!  Let's try!!!!</span></span><br><span class="line">                <span class="comment">// This is exciting!!1!!1!!!!1</span></span><br><span class="line">                unstableProviderDied(unstableProvider);</span><br><span class="line">                stableProvider = acquireProvider(uri);<span class="comment">//第一次创建的是不稳定的，如果失败就重试</span></span><br><span class="line">                <span class="keyword">if</span> (stableProvider == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                qCursor = stableProvider.query(</span><br><span class="line">                        mPackageName, uri, projection, queryArgs, remoteCancellationSignal);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (qCursor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Force query execution.  Might fail and throw a runtime exception here.</span></span><br><span class="line">            qCursor.getCount();<span class="comment">//调用这个方法判断是否查询出错</span></span><br><span class="line">            <span class="keyword">long</span> durationMillis = SystemClock.uptimeMillis() - startTime;</span><br><span class="line">            maybeLogQueryToEventLog(durationMillis, uri, projection, queryArgs);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Wrap the cursor object into CursorWrapperInner object.</span></span><br><span class="line">            <span class="keyword">final</span> IContentProvider provider = (stableProvider != <span class="keyword">null</span>) ? stableProvider</span><br><span class="line">                    : acquireProvider(uri);</span><br><span class="line">            <span class="keyword">final</span> CursorWrapperInner wrapper = <span class="keyword">new</span> CursorWrapperInner(qCursor, provider);<span class="comment">//CursorWrapperInner是内部类</span></span><br><span class="line">            stableProvider = <span class="keyword">null</span>;</span><br><span class="line">            qCursor = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span> wrapper;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            <span class="comment">// Arbitrary and not worth documenting, as Activity</span></span><br><span class="line">            <span class="comment">// Manager will kill this process shortly anyway.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;<span class="comment">//释放资源</span></span><br><span class="line">           ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> IContentProvider <span class="title">acquireUnstableProvider</span><span class="params">(Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!SCHEME_CONTENT.equals(uri.getScheme())) &#123;<span class="comment">//SCHEME_CONTENT为content,如果uri的scheme为null则返回null</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String auth = uri.getAuthority();</span><br><span class="line">        <span class="keyword">if</span> (auth != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> acquireUnstableProvider(mContext, uri.getAuthority());<span class="comment">//这里调用的是ApplicationContentResolver的acquireUnstableProvider方法</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在<code>ContentResolver</code>的源码中<code>query</code>有三个重载方法1，2，3，在实例中我们调用重载方法1，方法1中则直接调用方法2。在方法2中，封装了数据到<code>Bundle</code>中，并调用了方法3，真正的实现在方法3中。方法3中的核心方法是<code>acquireUnstableProvider(Uri uri)</code>,它获取<code>IContentProvider</code>(一个IPC 接口)，并通过<code>IContentProvider</code>来获取联系人的数据。而<code>acquireUnstableProvider(Uri uri)</code>调用的是<code>acquireUnstableProvider(Context c, String name)</code>方法，它是个抽象方法，具体的实现类是<code>ApplicationContentResolver</code>。</p>
<p><code>ApplicationContentResolver</code>的<code>acquireUnstableProvider</code>方法源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> IContentProvider <span class="title">acquireUnstableProvider</span><span class="params">(Context c, String auth)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> mMainThread.acquireProvider(c,</span><br><span class="line">                 ContentProvider.getAuthorityWithoutUserId(auth),</span><br><span class="line">                 resolveUserIdFromAuthority(auth), <span class="keyword">false</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>在<code>ApplicationContentResolver</code>的<code>acquireUnstableProvider</code>方法调用了<code>ActivityThread</code>的<code>acquireProvider</code>方法，源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> IContentProvider <span class="title">acquireProvider</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"> Context c, String auth, <span class="keyword">int</span> userId, <span class="keyword">boolean</span> stable)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 判断缓存中是否有对应的IContentProvider，有则直接返回</span></span><br><span class="line"><span class="keyword">final</span> IContentProvider provider = acquireExistingProvider(c, auth, userId, stable);</span><br><span class="line">       <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> provider;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// There is a possible race here.  Another thread may try to acquire</span></span><br><span class="line">        <span class="comment">// the same provider at the same time.  When this happens, we want to ensure</span></span><br><span class="line">        <span class="comment">// that the first one wins.</span></span><br><span class="line">        <span class="comment">// Note that we cannot hold the lock while acquiring and installing the</span></span><br><span class="line">        <span class="comment">// provider since it might take a long time to run and it could also potentially</span></span><br><span class="line">        <span class="comment">// be re-entrant in the case where the provider is in the same process.</span></span><br><span class="line">        ContentProviderHolder holder = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//通过AMS获取ContentProviderHolder， 处理在不同进程的情况，</span></span><br><span class="line">            <span class="comment">//如果在同一进程就让`holder.provider = null;`</span></span><br><span class="line">            holder = ActivityManager.getService().getContentProvider(</span><br><span class="line">                    getApplicationThread(), auth, userId, stable);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ex.rethrowFromSystemServer();</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">//失败</span></span><br><span class="line">       <span class="keyword">if</span> (holder == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Slog.e(TAG, <span class="string">"Failed to find provider info for "</span> + auth);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Install provider will increment the reference count for us, and break</span></span><br><span class="line">        <span class="comment">// any ties in the race.</span></span><br><span class="line">        <span class="comment">//如果在同一进程，则进行相应的处理</span></span><br><span class="line">        holder = installProvider(c, holder, holder.info,</span><br><span class="line">                <span class="keyword">true</span> <span class="comment">/*noisy*/</span>, holder.noReleaseNeeded, stable);</span><br><span class="line">        <span class="keyword">return</span> holder.provider;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>ApplicationContentResolver</code>通过调用<code>ActivityThread的acquireProvider</code>方法来获取<code>ContentProvider</code>;<code>ActivityThread</code>先会判断缓存中是否存在要求的<code>IContentProvider</code>,<br>如果存在就直接返回，如果不存在就调用AMS的<code>getContentProviderImpl()</code>和<code>installProvider</code>来获取。</p>
<p>关于AMS获取IContentProvider的详细流程，可以看<a href="https://juejin.im/entry/5bfcf8566fb9a049ba414362" target="_blank" rel="noopener">ContentProvider启动过程分析</a></p>
<h2 id="ContactsContract详解"><a href="#ContactsContract详解" class="headerlink" title="ContactsContract详解"></a>ContactsContract详解</h2><p><code>ContactsContract</code>是存储联系人的数据表的常量字段，它有几个常用的内部类如下：</p>
<ul>
<li>ContactsContract.Data：数据表的常量，包含与原始联系人关联的数据点。 数据表的每一行通常用于存储单条联系信息（例如电话号码）及其相关元数据（例如，它是工作号码还是家庭号码）</li>
<li>ContactsContract.CommonDataKinds：用于定义存储在ContactsContract.Data表中的公共数据类型的容器。</li>
<li>ContactsContract.Contacts：联系人表的常量，包含代表同一个人的每个原始联系人聚合的记录</li>
</ul>
<blockquote>
<p>联系人数据是存储在数据库中（具体位置在data/data/com.android.providers.contacts/databases中），根据其MIME类型来判断其位置所代表的意义。如<br><code>ContactsContract.CommonDataKinds.Phone.NUMBER</code>和<code>ContactsContract.CommonDataKinds.Email.ADDRESS</code>都表示<br><code>data1</code>,但是在数据库中不同的MIME类型的<code>data1</code>表示不同的数据。</p>
</blockquote>
<p>数据库中<code>data</code>表的字段和数据如下（字段太多，只截取了部分） </p>
<p><img src="/2019/05/29/Android应用之间数据的交互-获取系统应用的数据/1.png" alt></p>
<p>MIME类型如下</p>
<p><img src="/2019/05/29/Android应用之间数据的交互-获取系统应用的数据/2.png" alt></p>
<p>通过<code>MIME</code>类型来获取所需要的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Uri p = ContactsContract.Data.CONTENT_URI;</span><br><span class="line">Cursor id = getActivity().getContentResolver().query(p,<span class="keyword">new</span> String[]&#123;ContactsContract.Data.CONTACT_ID&#125;,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">while</span> (id.moveToNext())&#123;</span><br><span class="line">    Cursor cursor=getActivity().getContentResolver().query(p, <span class="keyword">null</span>,ContactsContract.Data.CONTACT_ID+<span class="string">"= ?"</span>, <span class="keyword">new</span> String[]&#123;id.getString(id.getColumnIndex(ContactsContract.Data.CONTACT_ID))&#125;, <span class="keyword">null</span>);</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    <span class="keyword">byte</span>[] image = <span class="keyword">null</span>;</span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">while</span> (cursor.moveToNext())&#123;</span><br><span class="line">            String mime = cursor.getString(cursor.getColumnIndex(ContactsContract.Data.MIMETYPE));</span><br><span class="line">            Log.d(<span class="string">"==========="</span>,<span class="string">"mime = "</span>+mime);</span><br><span class="line">            <span class="keyword">if</span> (mime.equals(ContactsContract.CommonDataKinds.Phone.CONTENT_ITEM_TYPE))&#123;</span><br><span class="line">                builder.append(<span class="string">"name = "</span>+cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME)));</span><br><span class="line">                builder.append(<span class="string">"number = "</span>+cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER)));</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (mime.equals(ContactsContract.CommonDataKinds.Photo.CONTENT_ITEM_TYPE))&#123;</span><br><span class="line">            <span class="comment">//二进制数据一般放在data15中</span></span><br><span class="line">                image=cursor.getBlob(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Photo.DATA15));</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (mime.equals(ContactsContract.CommonDataKinds.Email.CONTENT_ITEM_TYPE))&#123;</span><br><span class="line">                builder.append(<span class="string">"email = "</span>+cursor.getString(cursor.getColumnIndex(ContactsContract.CommonDataKinds.Email.ADDRESS)));</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (mime.equals(ContactsContract.CommonDataKinds.StructuredPostal.CONTENT_ITEM_TYPE))&#123;</span><br><span class="line">                builder.append(<span class="string">"address = "</span>+cursor.getString(cursor.getColumnIndex(ContactsContract.</span><br><span class="line">                        CommonDataKinds.StructuredPostal.STREET)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    String con=builder.toString();</span><br><span class="line">    Log.d(<span class="string">"==========="</span>,con);</span><br><span class="line">    cursor.close();</span><br><span class="line">    &#125;</span><br><span class="line">id.close();</span><br></pre></td></tr></table></figure>
<p><code>ContentResolver()</code>还有<code>insert</code>、<code>delete</code>、<code>update</code>方法，其用法与<code>query</code>类似，这里不再介绍。</p>
<h2 id="获取其他系统应用数据"><a href="#获取其他系统应用数据" class="headerlink" title="获取其他系统应用数据"></a>获取其他系统应用数据</h2><h3 id="CalendarContract"><a href="#CalendarContract" class="headerlink" title="CalendarContract"></a>CalendarContract</h3><p><code>CalendarContract</code>是存储日历和事件相关信息字段表，与<code>ContactsContract</code>类似。<code>CalendarContract</code>也有几个内部类，常用的是<code>CalendarContract.Events</code>，包含诸如事件标题，位置，开始时间，结束时间等信息。<code>CalendarContract.Events</code>的使用如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    Uri p = CalendarContract.Events.CONTENT_URI;</span><br><span class="line">    Cursor cursor=getActivity().getContentResolver().query(p, <span class="keyword">null</span>,<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">while</span> (cursor.moveToNext())&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">       builder.append(<span class="string">"标题 : "</span>+cursor.getString(cursor.getColumnIndex(CalendarContract.Events.TITLE))+<span class="string">"\n"</span>)</span><br><span class="line">               .append(<span class="string">"起始时间 ："</span>+cursor.getString(cursor.getColumnIndex(CalendarContract.Events.DTSTART))+<span class="string">"\n"</span>)</span><br><span class="line">               .append(<span class="string">"结束时间 ："</span>+cursor.getString(cursor.getColumnIndex(CalendarContract.Events.DTEND))+<span class="string">"\n"</span>)</span><br><span class="line">               .append(<span class="string">"描述 : "</span>+cursor.getString(cursor.getColumnIndex(CalendarContract.Events.DESCRIPTION))+<span class="string">"\n"</span>);</span><br><span class="line">        contents.add(builder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">cursor.close();</span><br></pre></td></tr></table></figure></p>
<p>更多关于<code>CalendarContract</code>的使用，可以查看官方文档。</p>
<h3 id="MediaStore"><a href="#MediaStore" class="headerlink" title="MediaStore"></a>MediaStore</h3><p><code>MediaStore</code>包含内部和外部存储设备上所有可用媒体的元数据。其内部类如下：</p>
<ul>
<li>MediaStore.Audio：集装箱所有的音频内容。</li>
<li>MediaStore.Files：媒体提供程序表，包含媒体存储中所有文件的索引，包括非媒体文件。</li>
<li>MediaStore.Images：包含所有可用图像的元数据</li>
<li>interface MediaStore.MediaColumns：大多数MediaProvider表的公共字段</li>
<li>MediaStore.Video：包含所有可用视频的元数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; contents = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Uri p1 = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">Cursor cursor1=getActivity().getContentResolver().query(p1, <span class="keyword">null</span>,<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">while</span> (cursor1.moveToNext())&#123;</span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    builder.append(<span class="string">"文件名 : "</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.TITLE))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"描述 ："</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.DESCRIPTION))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"大小 ："</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.SIZE))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"位置 : "</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.DATA))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"文件修改时间："</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.DATE_MODIFIED))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"DISPLAY_NAME ："</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.DISPLAY_NAME))+<span class="string">"\n"</span>)</span><br><span class="line">            .append(<span class="string">"时间 : "</span>+cursor1.getString(cursor1.getColumnIndex(MediaStore.Images.Media.DATE_TAKEN))+<span class="string">"\n"</span>);</span><br><span class="line">    contents.add(builder.toString());</span><br><span class="line">&#125;</span><br><span class="line">cursor1.close();</span><br></pre></td></tr></table></figure>
<h3 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h3><p><code>Settings</code>与<code>XXXContract</code>不同，它是通过xml文件来存储数据，在文件<code>/data/system/users/0/</code>目录下，获取设置的方式如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        ContentResolver contentResolver=getActivity().getContentResolver();</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">            builder.append(<span class="string">"wifi是否开启："</span>+Settings.Global.getString(contentResolver,Settings.Global.WIFI_ON)+<span class="string">"\n"</span>)</span><br><span class="line">                   .append(<span class="string">"数据流量是否开启："</span>+Settings.Global.getString(contentResolver,Settings.Global.DATA_ROAMING)+<span class="string">"\n"</span>)</span><br><span class="line">                   .append(Settings.System.NOTIFICATION_SOUND+<span class="string">" "</span>+Settings.System.getString(contentResolver,Settings.System.NOTIFICATION_SOUND)).append(<span class="string">"\n"</span>)</span><br><span class="line">                    .append(Settings.System.SCREEN_BRIGHTNESS+<span class="string">" "</span>+Settings.System.getString(contentResolver,Settings.System.SCREEN_BRIGHTNESS)).append(<span class="string">"\n"</span>)</span><br><span class="line">                    .append(Settings.System.TEXT_SHOW_PASSWORD+<span class="string">" "</span>+Settings.System.getString(contentResolver,Settings.System.TEXT_SHOW_PASSWORD)).append(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(<span class="string">"=============="</span>,builder.toString());</span><br></pre></td></tr></table></figure></p>
<p>更多关于<code>Setting</code>的内容可以看<a href="https://blog.csdn.net/myfriend0/article/details/59107989" target="_blank" rel="noopener">Android系统APP之SettingsProvider</a></p>
<blockquote>
<p>注意：以上的操作都是需要申请权限的</p>
</blockquote>
<h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3><p>如果请求数据的操作太过耗时，可能造成ANR，因此需要异步处理。异步处理的方式有：</p>
<ul>
<li>Thread + Handler </li>
<li>AsyncTask </li>
<li><a href="https://juejin.im/post/5a27c56e51882535cd4ab5af" target="_blank" rel="noopener">Loader</a></li>
<li>RxJava</li>
</ul>
<p>参考文章：<br></p>
<ul>
<li><a href="https://juejin.im/entry/5bfcf8566fb9a049ba414362" target="_blank" rel="noopener">https://juejin.im/entry/5bfcf8566fb9a049ba414362</a></li>
<li><a href="https://blog.csdn.net/myfriend0/article/details/59107989" target="_blank" rel="noopener">https://blog.csdn.net/myfriend0/article/details/59107989</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/22/java内存溢出异常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/22/java内存溢出异常/" itemprop="url">java内存溢出异常</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-22T20:45:56+08:00">
                2019-05-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/22/java内存区域/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/22/java内存区域/" itemprop="url">java内存区域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-22T20:45:33+08:00">
                2019-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index">
                    <span itemprop="name">jvm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2019/05/22/java内存区域/1.jpg" alt="java内存区域"></p>
<h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><p>程序计数器占用一小块内存空间，用来指示当前线程所执行的字节码行号。字节码解释器工作时就是通过改变<br>这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都<br>需要依赖这个计数器来完成。</p>
<blockquote>
<p>每一条线程都需要有一个独立的程序计数器，各条线程之间计数器互不影响，独立存储，我们称这类内存区域为<br>“线程私有”的内存。</p>
</blockquote>
<blockquote>
<p>如果线程执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令地址；如果正在执行的是native<br>方法，这个计数器值则为空。此内存区域是唯一一个在Java虚拟机规范中没有规定任何<code>OutOfMemoryError</code>情况的区域。</p>
</blockquote>
<h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><p>虚拟机栈和程序计数器一样也是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法在执行的同时<br>都会创建一个栈帧用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每一个方法从调用直至执行完成的过程中就对应着一个栈帧<br>在虚拟机栈中入栈到出栈的过程。</p>
<blockquote>
<p>经常有人把Java内存分为堆内存和栈内存；这里所指的栈是指虚拟机栈或者虚拟机栈中的局部变量表部分</p>
</blockquote>
<p>局部变量表存放了编译期可知的各种基本数据类型、对象引用（reference类型，它不等同于对象本身，可能是一个指向对象起始地址的引用指针，有可能是指向一个代表对象的句柄或其他与此对象相关<br>的位置）和returnAddress类型（指向了一条字节码指令的地址）</p>
<h2 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h2><p>虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则为虚拟机使用到的native方法服务</p>
<h2 id="Java堆"><a href="#Java堆" class="headerlink" title="Java堆"></a>Java堆</h2><p>对于大多数应用来说，Java堆是Java虚拟机所管理的内存中最大的一块。Java堆是被所有线程共享的一块内存区域，几乎<br>所有的对象实例都在这里分配内存。Java堆是垃圾收集器管理的主要区域，因此很多时候也被称为<code>GC堆</code></p>
<blockquote>
<p>当前主流的虚拟机都是按照可扩展来实现的（通过-Xmx和-Xms控制）如果在堆中没有内存完成实例分配，并且堆也无法再扩展<br>时，将抛出OutOfMemoryError异常</p>
</blockquote>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><p>方法区是各个线程共享的内存区域，用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</p>
<h2 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h2><p>运行时常量池是方法区的一部分。一般来说，除了保存Class文件中描述的符号引用外，还会把翻译出来的直接引用也存储在运行时常量池中</p>
<blockquote>
<p>注意:并非预置入Class文件中常量池的内容才能进入方法区运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用<br>的比较多的是String类的<code>intern()</code>方法</p>
</blockquote>
<h2 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h2><p>直接内存并不是虚拟机运行时内存的一部分，也不是jvm规范中定义的内存区域。它是由本机直接分配内存，不受Java堆大小的限制（但是<br>受本机总线程的限制）。</p>
<p>应用场景：NIO</p>
<blockquote>
<p>注意：在为服务器虚拟机配置参数时，不能忽略这部分内存，否则可能引发OutOfMemoryError异常</p>
</blockquote>
<h2 id="HotSpot虚拟机在Java堆中对象的分配、布局和访问的全过程"><a href="#HotSpot虚拟机在Java堆中对象的分配、布局和访问的全过程" class="headerlink" title="HotSpot虚拟机在Java堆中对象的分配、布局和访问的全过程"></a>HotSpot虚拟机在Java堆中对象的分配、布局和访问的全过程</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/22/《图解HTTP》核心总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/22/《图解HTTP》核心总结/" itemprop="url">《图解HTTP》核心总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-22T20:08:27+08:00">
                2019-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/计算机网络/" itemprop="url" rel="index">
                    <span itemprop="name">计算机网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转载<a href="https://juejin.im/post/5cd16ba251882541cc70cbf8" target="_blank" rel="noopener">《图解HTTP》核心总结</a></p>
<h2 id="HTTP协议的简介"><a href="#HTTP协议的简介" class="headerlink" title="HTTP协议的简介"></a>HTTP协议的简介</h2><p><code>HTTP</code>是超文本传输协议，用于客户端和服务器端之间的通信，属于<code>TCP/IP</code>中的应用层。</p>
<h2 id="HTTP协议的基础知识"><a href="#HTTP协议的基础知识" class="headerlink" title="HTTP协议的基础知识"></a>HTTP协议的基础知识</h2><h3 id="客户端和服务器端"><a href="#客户端和服务器端" class="headerlink" title="客户端和服务器端"></a>客户端和服务器端</h3><p>客户端是服务请求方，服务器端是服务提供方。</p>
<h3 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h3><p>URI:URI是统一资源标识符；</p>
<p>URL:是统一资源定位器;</p>
<blockquote>
<p>URI的格式(了解即可)<br><br><code>[scheme:][//user:password@]host[:port][/path][?query][#fragment]</code><br><br>如上是URI的具体格式，下面介绍其意义：</p>
<ul>
<li><code>scheme:</code>:是协议方案，比如<code>http:</code>,<code>https:</code>,<code>file:</code>等,此项可选可不选</li>
<li><code>[//[user:password@]</code>:指定用户名和密码作为从服务器获取资源时必要的登陆信息，此项是可选项</li>
<li><code>host</code>:服务器地址，例如<code>www.runoob.com</code></li>
<li><code>[:port]</code>：服务器端口号,例如：8080，此项是可选项</li>
<li><code>[/path]</code>:指定服务器上的文件路径来定位特指的资源</li>
<li><code>[?query]</code>:查询字符串，例如<code>?id=123&amp;pas=123</code></li>
<li><code>[#fragment]</code>:片段标识符</li>
</ul>
</blockquote>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>见<a href="https://juejin.im/post/59c6201df265da064428b835" target="_blank" rel="noopener">DNS基础知识</a></p>
<h2 id="HTTP的特点"><a href="#HTTP的特点" class="headerlink" title="HTTP的特点"></a>HTTP的特点</h2><h3 id="HTTP通过请求和响应来达成通信"><a href="#HTTP通过请求和响应来达成通信" class="headerlink" title="HTTP通过请求和响应来达成通信"></a>HTTP通过请求和响应来达成通信</h3><p>如图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920d85391f81d?w=784&amp;h=287&amp;f=jpeg&amp;s=28546" alt></p>
<h2 id="HTTP-是无状态协议"><a href="#HTTP-是无状态协议" class="headerlink" title="HTTP 是无状态协议"></a>HTTP 是无状态协议</h2><p>HTTP 是无状态协议，它不对之前发生过的请求和响应的状态进行管理。也就是说，无法根据之前的状态进行本次的请求处理。</p>
<blockquote>
<p>假设要求登录认证的 Web 页面本身无法进行状态的管理（不记录已 登录的状态），那么每次跳转新页面不是要再次登录，就是要在每次 请求报文中附加参数来管理登录状态。</p>
</blockquote>
<p>HTTP使用 Cookie 的状态管理，Cookie 技术通过在请求和响应报文中写入 Cookie 信 息来控制客户端的状态。</p>
<p><code>Cookie</code> 会根据从服务器端发送的响应报文内的一个叫做 <code>Set-Cookie</code> 的首部字段信息，通知客户端保存<code>Cookie</code>。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 <code>Cookie</code> 值后发送出 去。服务器端发现客户端发送过来的 <code>Cookie</code> 后，会去检查究竟是从哪一 个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前 的状态信息。</p>
<p>如下图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920dec2814363?w=839&amp;h=486&amp;f=jpeg&amp;s=41430" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920e216daa2c1?w=848&amp;h=408&amp;f=jpeg&amp;s=38171" alt></p>
<h2 id="HTTP报文"><a href="#HTTP报文" class="headerlink" title="HTTP报文"></a>HTTP报文</h2><p><code>HTTP报文</code>是HTTP请求和响应的单位。用于请求的报文叫做<code>请求报文</code>，而用于响应的报文叫做<br><code>响应报文</code>。</p>
<h3 id="报文的结构如图"><a href="#报文的结构如图" class="headerlink" title="报文的结构如图"></a>报文的结构如图</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920e93e0b67f3?w=780&amp;h=437&amp;f=jpeg&amp;s=42989" alt></p>
<blockquote>
<p>报文主体和实体主体的差异 : <br><br>实体作为请求或响应的有效载荷数据（补充项）被传输，其内容由实体首部和实体主体组成。HTTP 报文的主体用于传输请求或响应的实体主体。<br>通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体 主体的内容发生变化，才导致它和报文主体产生差异</p>
</blockquote>
<h3 id="HTTP首部字段的结构"><a href="#HTTP首部字段的结构" class="headerlink" title="HTTP首部字段的结构"></a>HTTP首部字段的结构</h3><p><code>首部字段名: 字段值</code></p>
<p>如果有多个值，则<code>首部字段名: 字段值1, 字段值2</code></p>
<blockquote>
<p>如果HTTP首部字段重复了会如何？<br><br>当HTTP报文首部中出现中出现了两个或两个以上具有相同首部字段名时会怎么样？这种情况<br>在规范中尚未明确，根据浏览器内部处理逻辑的不同，结果可能并不一致。</p>
</blockquote>
<p>HTTP首部字段分为四个部分：</p>
<ul>
<li>通用首部字段：请求报文和响应报文两方都会使用的首部字段</li>
<li>请求首部字段：从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、响应内容相关优先级等信息。</li>
<li>响应首部字段：从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会为客户端附加额外的内容信息</li>
<li>实体首部字段：针对请求报文和响应报文的实体部分使用的首部。补充了资源内容的更新时间等与实体有关的信息</li>
</ul>
<h2 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h2><p>现在以请求菜鸟教程的报文为例来进行分析：</p>
<p>请求报文</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /HTTP/<span class="number">1.1</span>        <span class="comment">//请求行</span></span><br><span class="line">Host: www.runoob.com</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">66.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">66.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Referer: https://cn.bing.com/</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">Cookie: Hm_lvt_3eec0b7da6548cf07db3bc477ea905ee=1554627142,1556799533; _ga=GA1.2.579069872.1554627144; Hm_lpvt_3eec0b7da6548cf07db3bc477ea905ee=1556799533; _gid=GA1.2.1514513796.1556799533; _gat_gtag_UA_84264393_2=1</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1 </span></span><br><span class="line"><span class="comment">Cache-Control: max-age=0</span></span><br></pre></td></tr></table></figure>
<p>响应报文</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK      <span class="comment">//状态行</span></span><br><span class="line">Server: Tengine</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: <span class="number">150124</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Thu, <span class="number">02</span> May <span class="number">2019</span> <span class="number">09</span>:<span class="number">27</span>:<span class="number">08</span> GMT</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-M-Log: QNM:xs446;QNM3:<span class="number">1</span></span><br><span class="line">X-M-Reqid: jVAAADsHtCKO05oV</span><br><span class="line">X-Powered-By: HHVM/<span class="number">3.28</span>.1</span><br><span class="line">X-Qnm-Cache: Hit</span><br><span class="line">Ali-Swift-Global-Savetime: <span class="number">1556270140</span></span><br><span class="line">Via: cache16.l2cn1807[<span class="number">0</span>,<span class="number">200</span>-<span class="number">0</span>,H], cache37.l2cn1807[<span class="number">1</span>,<span class="number">0</span>], cache9.cn1066[<span class="number">0</span>,<span class="number">200</span>-<span class="number">0</span>,H], cache5.cn1066[<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">Age: <span class="number">10328</span></span><br><span class="line">X-Cache: HIT TCP_MEM_HIT dirn:<span class="number">11</span>:<span class="number">466942761</span></span><br><span class="line">X-Swift-SaveTime: Thu, <span class="number">02</span> May <span class="number">2019</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">54</span> GMT</span><br><span class="line">X-Swift-CacheTime: <span class="number">86400</span></span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">EagleId: db971b1915567995564074785e</span><br></pre></td></tr></table></figure>
<h3 id="请求行和状态行"><a href="#请求行和状态行" class="headerlink" title="请求行和状态行"></a>请求行和状态行</h3><blockquote>
<p>请求行：请求行中包含用于请求的方法，请求的URI和HTTP版本<br><br>状态行：状态行包含响应结果的状态码，原因短语和HTTP版本</p>
</blockquote>
<p>在请求报文中<code>GET /HTTP/1.1</code>是请求行，其中<code>GET</code>代表请求的方法，<code>/HTTP/1.1</code>代表HTTP版本，在这个请求中未出现请求的<code>URI</code>。</p>
<p>在响应报文中<code>HTTP/1.1 200 OK</code>是状态行，其中<code>HTTP/1.1</code>是请求的版本，<code>200</code>是响应结果的状态码，而<code>OK</code><br>则是原因短语。</p>
<h3 id="请求的方法"><a href="#请求的方法" class="headerlink" title="请求的方法"></a>请求的方法</h3><p>GET：GET方法用来访问以被URI识别的资源。指定的资源经服务器解析后返回响应的内容。如下图</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920f051089f47?w=643&amp;h=257&amp;f=jpeg&amp;s=14320" alt></p>
<p>POST: POST方法用来传输实体的主体。如下图</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920f376c74a87?w=643&amp;h=254&amp;f=jpeg&amp;s=14297" alt></p>
<p>其他方法如<code>PUT HEAD DELETE OPTIONS TRACE CONNECT</code>一般不使用。下面简单介绍一下：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>不使用的原因</th>
</tr>
</thead>
<tbody>
<tr>
<td>PUT</td>
<td>用来传输文件</td>
<td>PUT方法不采用任何验证机制，存在安全问题</td>
</tr>
<tr>
<td>HEAD</td>
<td>和GET方法一样，不过只返回响应首部</td>
<td>—</td>
</tr>
<tr>
<td>DELETE</td>
<td>用来删除文件</td>
<td>DELETE不采用任何验证机制，存在安全问题</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>查询针对请求URI指定的资源支持的方法</td>
<td>—-</td>
</tr>
<tr>
<td>TRACE</td>
<td>让WEB服务器端将之前的请求通信返回给客户端</td>
<td>容易引发跨站追踪（XST）攻击</td>
</tr>
<tr>
<td>CONNECT</td>
<td>要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信</td>
<td>—-</td>
</tr>
</tbody>
</table>
<h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9214d497ab1f3?w=723&amp;h=283&amp;f=jpeg&amp;s=43917" alt></p>
<h4 id="2XX"><a href="#2XX" class="headerlink" title="2XX"></a>2XX</h4><h5 id="200-ok"><a href="#200-ok" class="headerlink" title="200 ok"></a>200 ok</h5><p>表示从客户端发来的请求在服务器端被正常处理了</p>
<h5 id="204-Not-Content"><a href="#204-Not-Content" class="headerlink" title="204 Not Content"></a>204 Not Content</h5><p>该状态码代表服务器接收的请求已经被成功处理，但是返回的响应报文中不包含实体的主体部分</p>
<h5 id="206-Partial-Content"><a href="#206-Partial-Content" class="headerlink" title="206 Partial Content"></a>206 Partial Content</h5><p>该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求</p>
<h4 id="3XX"><a href="#3XX" class="headerlink" title="3XX"></a>3XX</h4><h5 id="301-Moved-Permanently"><a href="#301-Moved-Permanently" class="headerlink" title="301 Moved Permanently"></a>301 Moved Permanently</h5><p>永久性重定向，该状态码表示请求的资源已被分配到新的URI，以后应该<br>使用现在所指的URI。</p>
<h5 id="302-Found"><a href="#302-Found" class="headerlink" title="302 Found"></a>302 Found</h5><p>临时重定向。该状态码表明请求的资源已被分配了新的URI，希望用户本次能使用新的URI访问。</p>
<h5 id="303-See-Other"><a href="#303-See-Other" class="headerlink" title="303 See Other"></a>303 See Other</h5><p>该状态码表示由于请求资源存在另一个URI，应该使用GET方法定向获取请求的资源</p>
<h5 id="304-Not-Modified"><a href="#304-Not-Modified" class="headerlink" title="304 Not Modified"></a>304 Not Modified</h5><p>该状态码表示客户端发送附带条件请求时，服务器端允许请求访问资源，但因为请求未满足条件的情况后，<br>直接返回304.</p>
<h5 id="307-Temporary-Redirect"><a href="#307-Temporary-Redirect" class="headerlink" title="307 Temporary Redirect"></a>307 Temporary Redirect</h5><p>临时重定向，和302相似。但是307不会从Post变成GET</p>
<h4 id="4XX"><a href="#4XX" class="headerlink" title="4XX"></a>4XX</h4><h5 id="400-Bad-Request"><a href="#400-Bad-Request" class="headerlink" title="400 Bad Request"></a>400 Bad Request</h5><p>该状态码表示请求报文中存在语法错误。当错误发生时，需要修改请求的内容后再次发送请求</p>
<h5 id="401-Unauthorized"><a href="#401-Unauthorized" class="headerlink" title="401 Unauthorized"></a>401 Unauthorized</h5><p>该状态码表示发送的请求需要通过HTTP认证的认证信息。另外若之前已经进行过一次请求，则表示用户认证失败</p>
<h5 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h5><p>该状态码表明对请求资源的访问被服务器拒绝了</p>
<h5 id="404-Not-Found"><a href="#404-Not-Found" class="headerlink" title="404 Not Found"></a>404 Not Found</h5><p>该状态码表明服务器上无法找到请求的资源</p>
<h4 id="5XX"><a href="#5XX" class="headerlink" title="5XX"></a>5XX</h4><h5 id="500-Internal-Server-Error"><a href="#500-Internal-Server-Error" class="headerlink" title="500 Internal Server Error"></a>500 Internal Server Error</h5><p>该主题码表示服务器在执行请求时发生了错误</p>
<h5 id="503-Service-Unavailable"><a href="#503-Service-Unavailable" class="headerlink" title="503 Service Unavailable"></a>503 Service Unavailable</h5><p>该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。</p>
<h3 id="HTTP所有的首部字段"><a href="#HTTP所有的首部字段" class="headerlink" title="HTTP所有的首部字段"></a>HTTP所有的首部字段</h3><p>HTTP/1.1定义了如下47种首部地段，如下</p>
<p>通用首部字段：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920fd0d3d332e?w=655&amp;h=427&amp;f=jpeg&amp;s=44705" alt></p>
<p>请求首部字段：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920ff9aa1a9f9?w=608&amp;h=728&amp;f=jpeg&amp;s=101123" alt></p>
<p>响应首部字段：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9210213d28f19?w=709&amp;h=450&amp;f=jpeg&amp;s=53018" alt></p>
<p>实体首部字段： </p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92106a075a602?w=655&amp;h=455&amp;f=jpeg&amp;s=56957" alt></p>
<p>非HTTP/1.1首部字段（不属于47种中的字段）:<code>Cookie</code>、 <code>Set-Cookie</code>、 <code>Content-Disposition</code>等。</p>
<h3 id="端到端首部和逐跳首部"><a href="#端到端首部和逐跳首部" class="headerlink" title="端到端首部和逐跳首部"></a>端到端首部和逐跳首部</h3><p>HTTP将使用 <code>缓存代理</code>和<code>非缓存代理</code> 的首部字段分成两种类型：端到端首部（End-to-end Header）、逐跳首部(Hop-by-hop Header)</p>
<blockquote>
<p>缓存代理<br><br>代理转发响应时，缓存代理（Caching Proxy）会预先将资源的副本 （缓存）保存在代理服务器上。<br>当代理再次接收到对相同资源的请求时，就可以不从源服务器那里获 取资源，而是将之前缓存的资源作为响应返回。<br><br>透明代理<br><br>转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理 （Transparent Proxy）。反之，对报文内容进行加工的代理被称为非 透明代理。<br><br></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：这里的非缓存代理不等于透明代理；它们划分的标准不一样。`缓存代理`和`非缓存代理`是通过是否使用缓存来划分的；而`透明代理`和`非透明代理`是通过是否会修改报文来划分。</span><br></pre></td></tr></table></figure>
<p>端到端首部：分在此类别中的首部会转发给请求/响应对应的最终接收目标(即<strong>全程有效</strong>)，且必须保存在由缓存生成的响应中，另外规定它必须被转发</p>
<p>逐跳首部：分在此类别的首部只对<strong>单次转发有效</strong>，会因为通过缓存或代理而不再转发。在HTTP/1.1和以后版本中，如果要使用逐跳首部，需要通过Connection首部字段</p>
<p>逐跳首部字段为：</p>
<ul>
<li>Connection </li>
<li>Keep-Alive(新增字段，可忽略) </li>
<li>Proxy-Authenticate </li>
<li>Proxy-Authorization </li>
<li>Trailer </li>
<li>TE </li>
<li>Transfer-Encoding </li>
<li>Upgrade</li>
</ul>
<p>其他字段都为端到端首部</p>
<h3 id="通用首部字段"><a href="#通用首部字段" class="headerlink" title="通用首部字段"></a>通用首部字段</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920fd0d3d332e?w=655&amp;h=427&amp;f=jpeg&amp;s=44705" alt></p>
<p>在实例的请求报文中出现的通用首部</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: max-age=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>在实例的响应报文中出现的通用首部</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Connection: keep-alive</span><br><span class="line">Date: Thu, <span class="number">02</span> May <span class="number">2019</span> <span class="number">09</span>:<span class="number">27</span>:<span class="number">08</span> GMT</span><br><span class="line">Via: cache16.l2cn1807[<span class="number">0</span>,<span class="number">200</span>-<span class="number">0</span>,H], cache37.l2cn1807[<span class="number">1</span>,<span class="number">0</span>], cache9.cn1066[<span class="number">0</span>,<span class="number">200</span>-<span class="number">0</span>,H], cache5.cn1066[<span class="number">1</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h4 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h4><p>通过指定首部字段Cathe-Control的指令，就可以操作缓存的工作机制，如图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9212af6e3f579" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a921303299bde9?w=781&amp;h=470&amp;f=jpeg&amp;s=73135" alt></p>
<p>请求报文中<code>Cache-Control: max-age=0</code>表示缓存服务器通常需要将请求转发给源服务器。</p>
<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><p><code>Connection</code>的作用：</p>
<ol>
<li>控制不再转发给代理的首部字段</li>
<li>管理持久化连接</li>
</ol>
<h5 id="控制不再转发给代理的首部字段"><a href="#控制不再转发给代理的首部字段" class="headerlink" title="控制不再转发给代理的首部字段"></a>控制不再转发给代理的首部字段</h5><p><img src="https://user-gold-cdn.xitu.io/2019/5/8/16a96bf3f0296e25?w=720&amp;h=315&amp;f=jpeg&amp;s=38966" alt></p>
<blockquote>
<p>代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求 URI，会直接发送给前方持有资源的目标服务器。上面介绍的缓存代理是代理服务器作用的一种。</p>
</blockquote>
<h5 id="管理持久化连接"><a href="#管理持久化连接" class="headerlink" title="管理持久化连接"></a>管理持久化连接</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connection: close <span class="comment">//表明服务器想断开连接</span></span><br><span class="line">Connection: Keep-Alive <span class="comment">//保持持久化连接（默认）</span></span><br></pre></td></tr></table></figure>
<h4 id="Via"><a href="#Via" class="headerlink" title="Via"></a>Via</h4><p>用来追踪客户端与服务器端之间的请求和响应报文的传输路径。<br><br>如<code>Via: cache16.l2cn1807[0,200-0,H], cache37.l2cn1807[1,0], cache9.cn1066[0,200-0,H], cache5.cn1066[1,0]</code></p>
<h4 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h4><p>首部字段Date表明创建HTTP报文的时间，如<code>Date: Thu, 02 May 2019 09:27:08 GMT</code>就表示创建报文的时间为2019年5月2日，星期二。</p>
<h4 id="Pragma"><a href="#Pragma" class="headerlink" title="Pragma"></a>Pragma</h4><p>Pragma是历史遗留字段，仅作为与HTTP/1.0的向后兼容而定义。</p>
<h4 id="Trailer"><a href="#Trailer" class="headerlink" title="Trailer"></a>Trailer</h4><p>用来说明在报文主体后记录了哪些首部字段</p>
<h4 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h4><p>规定传输报文主体时采用的编码方式（仅对分块传输编码有效）</p>
<h4 id="Upgrade"><a href="#Upgrade" class="headerlink" title="Upgrade"></a>Upgrade</h4><p>用来检测HTTP协议及其他协议是否可使用更高的版本进行通信。</p>
<h4 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h4><p>告诉用户一些与缓存有关的问题的警告</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92138ef2c4d6e?w=763&amp;h=116&amp;f=jpeg&amp;s=18452" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9213b90e5293a?w=759&amp;h=451&amp;f=jpeg&amp;s=75608" alt></p>
<h3 id="请求首部字段"><a href="#请求首部字段" class="headerlink" title="请求首部字段"></a>请求首部字段</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a920ff9aa1a9f9?w=608&amp;h=728&amp;f=jpeg&amp;s=101123" alt></p>
<p>请求报文（去除了通用首部字段）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Host: www.runoob.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Referer: https://cn.bing.com/</span><br><span class="line">Cookie: Hm_lvt_3eec0b7da6548cf07db3bc477ea905ee=1554627142,1556799533; _ga=GA1.2.579069872.1554627144; Hm_lpvt_3eec0b7da6548cf07db3bc477ea905ee=1556799533; _gid=GA1.2.1514513796.1556799533; _gat_gtag_UA_84264393_2=1</span><br><span class="line">Upgrade-Insecure-Requests: 1 </span><br><span class="line">Cache-Control: max-age=0</span><br></pre></td></tr></table></figure>
<h4 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h4><p>告诉服务器请求的资源所处的互联网主机名和端口号，如<code>Host: www.runoob.com</code>。<em>Host是唯一必须包含在请求内的首部字段</em></p>
<h4 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h4><p>用来将创建请求的浏览器和用户代理名称等信息传达给服务器。</p>
<p>例如上面的请求首部:<br><br><code>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0</code></p>
<h4 id="Accept"><a href="#Accept" class="headerlink" title="Accept"></a>Accept</h4><p>通知服务器可以处理的媒体类型及媒体类型的相对优先级</p>
<p>例如<code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code></p>
<h5 id="媒体类型"><a href="#媒体类型" class="headerlink" title="媒体类型"></a>媒体类型</h5><p>文本文件</p>
<p>text/html, text/plain, text/css …<br>application/xhtml+xml, application/xml …</p>
<p>图片文件</p>
<p>image/jpeg, image/gif, image/png …</p>
<p>视频文件</p>
<p>video/mpeg, video/quicktime …</p>
<p>应用程序使用的二进制文件</p>
<p>application/octet-stream, application/zip</p>
<h5 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h5><p>使用<code>q=</code>来额外表示权重值，用<code>;</code>进行分隔。权重值的范围是0~1（可精确到小数点后3位），且1为最大值。不指定<br>权重值时，默认权重为q=1.0.当服务器提供多个内容时会首先返回权重值最高的媒体类型。</p>
<h4 id="Accept-Charset"><a href="#Accept-Charset" class="headerlink" title="Accept-Charset"></a>Accept-Charset</h4><p><code>Accept-Charset</code>首部字段可用来通知服务器用户代理支持的字符集及字符集的相对优先顺序。另外可一次性指定多种字符集。与首部字段<br><code>Accept</code>相同的可用权重q值来表示相对优先级</p>
<h4 id="Accept-Encoding"><a href="#Accept-Encoding" class="headerlink" title="Accept-Encoding"></a>Accept-Encoding</h4><p>Accept-Encoding首部字段用来告知服务器用户代理支持的内容编码及内容编码的优先级顺序。可一次性指定多种内容编码，可用权重q来指定优先级<br>例如<code>Accept-Encoding: gzip, deflate, br</code></p>
<h4 id="Accept-Language"><a href="#Accept-Language" class="headerlink" title="Accept-Language"></a>Accept-Language</h4><p>首部字段Accept-Language用来告诉服务器用户代理能够处理的语言，可以指定多个语言，可以使用q来决定优先级。<br>例如<code>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</code></p>
<h4 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h4><p>用来告诉服务器，用户代理的认证信息</p>
<h4 id="Expect"><a href="#Expect" class="headerlink" title="Expect"></a>Expect</h4><p>告知服务器期望出现某种特定的行为</p>
<h4 id="From"><a href="#From" class="headerlink" title="From"></a>From</h4><p>告诉服务器使用用户代理的用户的电子邮箱地址</p>
<h4 id="If-Match"><a href="#If-Match" class="headerlink" title="If-Match"></a>If-Match</h4><p>告诉服务器匹配资源所用的实体标记（ETag）值，服务器会对比If-Match的字段值和资源的ETag值，仅<br>当两者一致时才执行请求.反之则返回状码412</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92141eb9e0c68?w=770&amp;h=665&amp;f=jpeg&amp;s=57956" alt></p>
<h4 id="If-Modified-Since"><a href="#If-Modified-Since" class="headerlink" title="If-Modified-Since"></a>If-Modified-Since</h4><p>告诉服务器若If-Modified-Since字段值早于资源更新的时间，则希望能处理该请求。<br>反之如果在If-Modified-Since指定的时间日期之后，如果请求的资源都没有更新，则<br>返回的状态码 304</p>
<h4 id="If-None-Match"><a href="#If-None-Match" class="headerlink" title="If-None-Match"></a>If-None-Match</h4><p>与If-Match相反</p>
<h4 id="If-Range"><a href="#If-Range" class="headerlink" title="If-Range"></a>If-Range</h4><p>告诉服务器若指定的If-Range字段值（ETag值或者时间）和请求资源的ETag值或时间相一致时，则作为范围请求处理。<br>反之，则返回全体资源。如图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92147f4f3e5ca?w=822&amp;h=783&amp;f=jpeg&amp;s=74478" alt></p>
<h4 id="If-Unmodified-Since"><a href="#If-Unmodified-Since" class="headerlink" title="If-Unmodified-Since"></a>If-Unmodified-Since</h4><p>与If-Modified-Since作用相反</p>
<h4 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h4><p>对于只需获取部分资源的范围请求，包含首部字段<code>Range</code>即可告知服务器资源的指定范围。<br>接收到附带<code>Range</code>首部字段请求的服务器，会在处理请求之后返回<code>206</code>.无法处理该范围的<br>请求时，则会返回<code>200</code>的响应及全部资源。</p>
<h4 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h4><p>告诉服务器请求的原始URI</p>
<p>例如：<code>Referer: https://cn.bing.com/</code>说明我是从微软必应请求的</p>
<h4 id="Upgrade-Insecure-Requests"><a href="#Upgrade-Insecure-Requests" class="headerlink" title="Upgrade-Insecure-Requests"></a>Upgrade-Insecure-Requests</h4><p><code>Upgrade-Insecure-Requests</code>是一个请求首部，用来向服务器端发送信号，表示客户端优先选择加密及带有身份验证的响应。不属于47种报文首部字段。</p>
<h4 id="TE"><a href="#TE" class="headerlink" title="TE"></a>TE</h4><p>告诉服务器，客户端能够处理的传输编码方式及相对优先级</p>
<h3 id="Transfer-Encoding-TE-Content-Encoding-Accept-Encoding四个首部字段的区别"><a href="#Transfer-Encoding-TE-Content-Encoding-Accept-Encoding四个首部字段的区别" class="headerlink" title="Transfer-Encoding,TE,Content-Encoding,Accept-Encoding四个首部字段的区别"></a>Transfer-Encoding,TE,Content-Encoding,Accept-Encoding四个首部字段的区别</h3><ul>
<li>Transfer-Encoding：用于指定传输报文主体时使用的编码方式，属于逐跳首部，即只在两个节点间有效。 </li>
<li>TE：用于告知服务器客户端能够处理的编码方式和相对优先级，属于逐跳首部，即只在两个节点间有效。 </li>
<li>Content-Encoding：用于指定报文主体已经采用的编码方式，属于端到端首部，即在整个传输过程中有效。 </li>
<li>Accept-Encoding：用于告知服务器客户端能够处理的编码方式和相对优先级，属于端到端首部，即在整个传输过程中有效。 </li>
</ul>
<p>很显然，<code>Transfer-Encoding</code>和<code>TE</code>是一组，<code>Content-Encoding</code>和<code>Accept-Encoding</code>是一组。<br>根本区别在于，<code>Content-Encoding</code>和<code>Accept-Encoding</code>限制的是报文主体在整个传输过程中使用的编码方式，全局有效；<code>Transfer-Encoding</code>和<code>TE</code>限制的是报文主体在两个节点间（源服务器和代理服务器之间、代理服务器和客户端之间等）传输时使用的编码方式，只在两节点间有效。</p>
<p>转自<a href="https://blog.csdn.net/swt369/article/details/77847896" target="_blank" rel="noopener">区分Transfer-Encoding,TE,Content-Encoding,Accept-Encoding四个首部字段</a></p>
<h3 id="响应首部字段"><a href="#响应首部字段" class="headerlink" title="响应首部字段"></a>响应首部字段</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9210213d28f19?w=709&amp;h=450&amp;f=jpeg&amp;s=53018" alt></p>
<p>响应报文</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Server: Tengine</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-M-Log: QNM:xs446;QNM3:<span class="number">1</span></span><br><span class="line">X-M-Reqid: jVAAADsHtCKO05oV</span><br><span class="line">X-Powered-By: HHVM/<span class="number">3.28</span>.1</span><br><span class="line">X-Qnm-Cache: Hit</span><br><span class="line">Ali-Swift-Global-Savetime: <span class="number">1556270140</span></span><br><span class="line">Age: <span class="number">10328</span></span><br><span class="line">X-Cache: HIT TCP_MEM_HIT dirn:<span class="number">11</span>:<span class="number">466942761</span></span><br><span class="line">X-Swift-SaveTime: Thu, <span class="number">02</span> May <span class="number">2019</span> <span class="number">10</span>:<span class="number">36</span>:<span class="number">54</span> GMT</span><br><span class="line">X-Swift-CacheTime: <span class="number">86400</span></span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">EagleId: db971b1915567995564074785e</span><br></pre></td></tr></table></figure>
<h4 id="Accept-Ranges"><a href="#Accept-Ranges" class="headerlink" title="Accept-Ranges"></a>Accept-Ranges</h4><p>首部字段Accept-Ranges是用来告诉客户端服务器是否能处理范围请求，以指定获取服务器端<br>某个部分的资源。可以指定的值为<code>bytes</code>(表示接受范围请求)和<code>none</code>（表示不接受范围请求）.</p>
<h4 id="Age"><a href="#Age" class="headerlink" title="Age"></a>Age</h4><p>告诉客户端，源服务器在多久前创建了响应。字段值的单位为秒。</p>
<h4 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h4><p>主要用于检验缓存是否改变。它告诉客户端实体标识，是一种可将资源以字符串的形式做唯一标识的方式。服务器会为每份资源分配对应的ETag值</p>
<p>另外当资源更新时，ETag值也需要更新。当资源被缓存时，就会被分配唯一的标识。若在下载过程中<br>出现连接的中断，再连接的情况，都会依照ETag值来指定资源。</p>
<p>ETag中有强ETag值和弱ETag值</p>
<p>强ETag值，无论实体发生多么细微的变化都会改变其值。</p>
<p>弱ETag值，只用于提示资源是否相同。只有资源发生了根本改变，产生差异时才会改变<code>ETag</code>值。这时，<br>会在字段值最开始处附加 <code>W/</code></p>
<h4 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h4><p>将响应接受方引领到某个与请求URI位置不同的资源。基本上，该字段会配合3XX的响应，提供重定向的URI。</p>
<h4 id="Proxy-Authenticate"><a href="#Proxy-Authenticate" class="headerlink" title="Proxy-Authenticate"></a>Proxy-Authenticate</h4><p>会把由代理服务器所要求的认证信息发生给客户端</p>
<h4 id="Retry-After"><a href="#Retry-After" class="headerlink" title="Retry-After"></a>Retry-After</h4><p>告诉客户端应该在多久之后再发送请求。主要配合状态码503响应或3xx响应一起使用。字段值可以指定为具体的日期时间，也可以是创建响应后的秒数</p>
<h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><p>告诉客户端当前服务器上安装的HTTP服务器应用程序的信息</p>
<h4 id="Vary"><a href="#Vary" class="headerlink" title="Vary"></a>Vary</h4><p>对缓存进行控制。具体见<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary" target="_blank" rel="noopener">这里</a></p>
<h4 id="WWW-Authenticate"><a href="#WWW-Authenticate" class="headerlink" title="WWW-Authenticate"></a>WWW-Authenticate</h4><p>用于HTTP访问认证</p>
<h3 id="实体首部字段"><a href="#实体首部字段" class="headerlink" title="实体首部字段"></a>实体首部字段</h3><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92106a075a602?w=655&amp;h=455&amp;f=jpeg&amp;s=56957" alt></p>
<h4 id="Allow"><a href="#Allow" class="headerlink" title="Allow"></a>Allow</h4><p>告诉客户端支持的请求方法</p>
<h4 id="Content-Encoding"><a href="#Content-Encoding" class="headerlink" title="Content-Encoding"></a>Content-Encoding</h4><p>告知客户端服务器对实体的主体部分选用的内容编码方式。内容编码是指在不丢失实体信息的前提下所进行的压缩</p>
<p>主要采用以下4种内容编码的方式</p>
<ul>
<li>gzip</li>
<li>compress</li>
<li>deflate</li>
<li>identity</li>
</ul>
<h4 id="Content-Language"><a href="#Content-Language" class="headerlink" title="Content-Language"></a>Content-Language</h4><p>告诉客户端，实体使用的语言</p>
<h4 id="Content-Length"><a href="#Content-Length" class="headerlink" title="Content-Length"></a>Content-Length</h4><p>表明实体主体部分的大小，单位是字节。对实体主体进行内容编码传输时，不能再使用Content-Length<br>首部字段</p>
<h4 id="Content-Location"><a href="#Content-Location" class="headerlink" title="Content-Location"></a>Content-Location</h4><p>给出报文主体部分相对应的URI。和首部字段Location不同，Content-Location表示的是报文主体返回资源对应的URI</p>
<h4 id="Content-MD5"><a href="#Content-MD5" class="headerlink" title="Content-MD5"></a>Content-MD5</h4><p>首部字段 Content-MD5 是一串由 MD5 算法生成的值，其目的在于检 查报文主体在传输过程中是否保持完整，以及确认传输到达。</p>
<h4 id="Content-Range"><a href="#Content-Range" class="headerlink" title="Content-Range"></a>Content-Range</h4><p>针对范围请求，返回响应时使用的首部字段Content-Range，能告诉客户端作为响应返回的实体的哪个部分<br>符合范围请求。字段值以字节为单位，表示当前发送部分及整个实体大小。</p>
<h4 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h4><p>说明实体主体内对象的媒体类型，和首部字段<code>Accept</code>一样，字段值用<code>type/subtype</code>形式赋值</p>
<p><code>Http Header</code>里的<code>Content-Type</code>一般有这三种：</p>
<ul>
<li>application/x-www-form-urlencoded：数据被编码为名称/值对(这是标准的编码格式)。</li>
<li>multipart/form-data： 数据被编码为一条消息，页上的每个控件对应消息中的一个部分。</li>
<li>text/plain： 数据以纯文本形式(text/json/xml/html)进行编码，其中不含任何控件或格式字符(postman软件里标的是RAW)</li>
</ul>
<blockquote>
<p>form的enctype属性为编码方式，常用有两种：<code>application/x-www-form-urlencoded</code>和<code>multipart/form-data</code>，默认为<code>application/x-www-form-urlencoded</code>。<br><br>当<code>action</code>为<code>get</code>时候，浏览器用<code>x-www-form-urlencoded</code>的编码方式把<code>form</code>数据转换成一个字串<code>（name1=value1&amp;name2=value2...）</code>，然后把这个字串追加到url后面，用?分割，加载这个新的url。<br><br>当<code>action</code>为<code>post</code>时候，浏览器把<code>form</code>数据封装到<code>http body</code>中，然后发送到<code>server</code>。 如果没有<code>type=file</code>的控件，用默认的<code>application/x-www-form-urlencoded</code>就可以了。 但是如果有<code>type=file</code>的话，就要用到<code>multipart/form-data</code>了。<br><br>当<code>action</code>为<code>post</code>且<code>Content-Type</code>类型是<code>multipart/form-data</code>，浏览器会把整个表单以控件为单位分割，并为每个部分加上<code>Content-Disposition</code>(form-data或者file),<code>Content-Type</code>(默认为<code>text/plain</code>),<code>name</code>(控件name)等信息，并加上分割符。</p>
</blockquote>
<p>转自<a href="https://www.cnblogs.com/52fhy/p/5436673.html" target="_blank" rel="noopener">Http Header里的Content-Type </a></p>
<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><p>会将资源失效的日期告诉客户端</p>
<h4 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h4><p>指明资源最终修改的时间</p>
<h3 id="为Cookie服务的首部字段"><a href="#为Cookie服务的首部字段" class="headerlink" title="为Cookie服务的首部字段"></a>为Cookie服务的首部字段</h3><h4 id="Set-Cookie"><a href="#Set-Cookie" class="headerlink" title="Set-Cookie"></a>Set-Cookie</h4><p>开始状态管理所使用的Cookie信息（响应首部字段）</p>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>告诉服务器，当客户端想获取HTTP状态管理支持时，就会在请求中包含从服务器接受到的Cookie。接收到多个<br>Cookie时，同时可以以多个Cookie形式发送</p>
<h2 id="其他首部字段"><a href="#其他首部字段" class="headerlink" title="其他首部字段"></a>其他首部字段</h2><p>HTTP首部字段是可以自行扩展的。所以在WEB服务器和浏览器应用上，会出现各种非标准的首部字段</p>
<h3 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h3><p>属于响应首部，用于控制网站内容在其他web网站的Frame标签内的显示问题。其主要目的是为了防止<br>点击劫持攻击</p>
<p>有两个可指定的字段值<br>DENY:拒绝<br>SAMEORIGIN:仅在同源域名下的页面匹配时许可</p>
<h3 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h3><p>属于响应首部，它是针对跨站脚本攻击（XSS）的一种对策，用于控制浏览器XSS防护机制开关。</p>
<p>字段值：<br>0：将XSS过滤设置为无效状态<br>1：将XSS过滤设置为有效状态</p>
<h3 id="DNT"><a href="#DNT" class="headerlink" title="DNT"></a>DNT</h3><p>属于请求字段，意味拒绝个人信息被采集，是表示拒绝被精准广告追踪的一种方法</p>
<p>字段值<br>0：同意被追踪<br>1：拒绝被追踪</p>
<h3 id="P3P"><a href="#P3P" class="headerlink" title="P3P"></a>P3P</h3><p>属于响应首部，通过利用 P3P（The Platform for Privacy Preferences，在线隐私偏好平台）技术，可以让 Web 网站上 的个人隐私变成一种仅供程序可理解的形式，以达到保护用户隐私的 目的。</p>
<h2 id="协议中对X-前缀的废除"><a href="#协议中对X-前缀的废除" class="headerlink" title="协议中对X-前缀的废除"></a>协议中对X-前缀的废除</h2><p>在HTTP等多种协议中，通过给非标准参数加上前缀X-，来区别于标准参数，并使那些非标准参数作为扩展变成可能（如上面的响应首部）。但是这种简单粗暴的做法没有任何好处，因此被提议停止。然而对已经在使用中的X-前缀来说，不应该要求其变更。</p>
<h2 id="HTTP的缺点"><a href="#HTTP的缺点" class="headerlink" title="HTTP的缺点"></a>HTTP的缺点</h2><ul>
<li>通信使用明文（不加密），内容可能被窃听</li>
<li>不验证通信方的身份，因此有可能遭受伪装</li>
<li>无法证明报文的完整性，所以内容可能被篡改</li>
</ul>
<p>HTTP+ 加密 + 认证 + 完整性保护 =HTTPS </p>
<p>HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代 替而已。<br>通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通 信，再由 SSL 和 TCP 通信了。简言之，所谓 HTTPS，其实就是身披 SSL 协议这层外壳的 HTTP</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92154eb3a0039?w=592&amp;h=298&amp;f=png&amp;s=49918" alt></p>
<p>在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护 这些功能。</p>
<p>SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应 用层的 SMTP 和 Telnet 等协议均可配合 SSL 协议使用。可以说 SSL 是 当今世界上应用最为广泛的网络安全技术。</p>
<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><p>加密和解密同用一个密钥的方式称为共享密钥加密（Common key crypto system），也被叫做对称密钥加密</p>
<p>共享密钥加密的困境</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a92158084c1816?w=638&amp;h=456&amp;f=jpeg&amp;s=32324" alt></p>
<p>以共享密钥方式加密时必须将密钥也发给对方。可究竟怎样才能 安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥 就可会落入攻击者之手，同时也就失去了加密的意义。另外还得 设法安全地保管接收到的密钥。</p>
<p>公开密钥加密使用一对非对称的密钥。一把叫做私有密钥 （private key），另一把叫做公开密钥（public key）。顾名思 义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发 布，任何人都可以获得。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9215bfd8e5a8a?w=797&amp;h=661&amp;f=jpeg&amp;s=57497" alt></p>
<h2 id="HTTPS-采用混合加密机制"><a href="#HTTPS-采用混合加密机制" class="headerlink" title="HTTPS 采用混合加密机制"></a>HTTPS 采用混合加密机制</h2><p>HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密 机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开 密钥加密来通信。</p>
<p>但是公开密钥加密与共享密钥加密相比，其处 理速度要慢。<br>所以应充分利用两者各自的优势，将多种方法组合起来用于通 信。在交换密钥环节使用公开密钥加密方式，之后的建立通信交 换报文阶段则使用共享密钥加密方式。</p>
<h2 id="证明公开密钥正确性的证书"><a href="#证明公开密钥正确性的证书" class="headerlink" title="证明公开密钥正确性的证书"></a>证明公开密钥正确性的证书</h2><p>遗憾的是，公开密钥加密方式还是存在一些问题的。那就是无法证明 公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器 建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原 本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真 正的公开密钥已经被攻击者替换掉了。</p>
<p>为了解决上述问题，可以使用由数字证书认证机构（CA，Certificate Authority）和其相关机关颁发的公开密钥证书</p>
<p>服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，<br>以进行公开密钥加密方式通信。</p>
<p>公钥证书也可叫做数字证书或直接称 为证书。<br>接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书 上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：</p>
<ul>
<li>认证服务器的公开密钥的是真实有效的数字证书认证机构。</li>
<li>服务器的公开密钥是值得信赖的。</li>
</ul>
<p>此处认证机关的公开密钥必须安全地转交给客户端。使用通信方式 时，如何安全转交是一件很困难的事，因此，多数浏览器开发商发布 版本时，会事先在内部植入常用认证机关的公开密钥。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a921608e553499?w=774&amp;h=609&amp;f=jpeg&amp;s=85974" alt></p>
<h2 id="HTTPS-的通信步骤"><a href="#HTTPS-的通信步骤" class="headerlink" title="HTTPS 的通信步骤"></a>HTTPS 的通信步骤</h2><p><img src="https://user-gold-cdn.xitu.io/2019/5/7/16a9216530d26350?w=742&amp;h=894&amp;f=jpeg&amp;s=60050" alt></p>
<ul>
<li>步骤 1： 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包 含客户端支持的 SSL 的指定版本、加密组件（Cipher Suite）列表（所 使用的加密算法及密钥长度等）。</li>
<li>步骤 2： 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应<br>答。和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的 加密组件内容是从接收到的客户端加密组件内筛选出来的。</li>
<li>步骤 3： 之后服务器发送 Certificate 报文。报文中包含公开密钥证 书。</li>
<li>步骤 4： 最后服务器发送 Server Hello Done 报文通知客户端，最初阶 段的 SSL 握手协商部分结束。 </li>
<li>步骤 5： SSL 第一次握手结束之后，客户端以 Client Key Exchange 报 文作为回应。报文中包含通信加密中使用的一种被称为 Pre-master secret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。 </li>
<li>步骤 6： 接着客户端继续发送 Change Cipher Spec 报文。该报文会提 示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。 </li>
<li>步骤 7： 客户端发送 Finished 报文。该报文包含连接至今全部报文的 整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确 解密该报文作为判定标准。</li>
<li>步骤 8： 服务器同样发送 Change Cipher Spec 报文。 </li>
<li>步骤 9： 服务器同样发送 Finished 报文。 </li>
<li>步骤 10： 服务器和客户端的 Finished 报文交换完毕之后，SSL 连接 就算建立完成。当然，通信会受到 SSL 的保护。从此处开始进行应用 层协议的通信，即发送 HTTP 请求。 </li>
<li>步骤 11： 应用层协议通信，即发送 HTTP 响应。 </li>
<li>步骤 12： 最后由客户端断开连接。断开连接时，发送 close_notify 报 文。上图做了一些省略，这步之后再发送 TCP FIN 报文来关闭与 TCP 的通信。<br>在以上流程中，应用层发送数据时会附加一种叫做 MAC（Message Authentication Code）的报文摘要。MAC 能够查知报文是否遭到篡 改，从而保护报文的完整性。</li>
</ul>
<blockquote>
<p>SSL 和 TLS HTTPS 使用 SSL（Secure Socket Layer） 和 TLS（Transport Layer Security）这两个协议。 SSL 技术最初是由浏览器开发商网景通信公司率先倡导的，开发 过 SSL3.0 之前的版本。目前主导权已转移到 IETF（Internet Engineering Task Force，Internet 工程任务组）的手中。 IETF 以 SSL3.0 为基准，后又制定了 TLS1.0、TLS1.1 和 TLS1.2。TSL 是以 SSL 为原型开发的协议，有时会统一称该协议 为 SSL。当前主流的版本是 SSL3.0 和 TLS1.0。 由于 SSL1.0 协议在设计之初被发现出了问题，就没有实际投入 使用。SSL2.0 也被发现存在问题，所以很多浏览器直接废除了 该协议版本。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/22/DNS详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/22/DNS详解/" itemprop="url">DNS详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-22T20:08:00+08:00">
                2019-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/计算机网络/" itemprop="url" rel="index">
                    <span itemprop="name">计算机网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>见<a href="https://juejin.im/post/59c6201df265da064428b835" target="_blank" rel="noopener">DNS基础知识</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/26/android的存储路径/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/26/android的存储路径/" itemprop="url">android的存储路径</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-26T22:23:12+08:00">
                2019-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android的储存"><a href="#Android的储存" class="headerlink" title="Android的储存"></a>Android的储存</h2><ul>
<li>内部储存</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context.getFilesDir();</span><br><span class="line"><span class="comment">//创建/data/user/0/com.example.androidbase/files文件夹，随着应用位置的改变，位置可能改变</span></span><br><span class="line">context.getCacheDir();</span><br><span class="line"><span class="comment">//创建/data/user/0/com.example.androidbase/cache文件夹当需要空间时，系统会自动删除其中的文件（先删除存在最长时间的）</span></span><br><span class="line">Environment.getDataDirectory()</span><br><span class="line"><span class="comment">//使用Environment来获取</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>读写上述的方法返回的文件对象是，不用申请权限，当用户卸载app时，系统会删除data目录下所有关于该app的文件</p>
<ul>
<li>外部储存的私有目录</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">context.getExternalCacheDir()：<span class="comment">//一般存放临时缓存数据，对应 清除缓存</span></span><br><span class="line">context.getExternalFilesDir(String type)：<span class="comment">//一般放一些长时间保存的数据，对应 清除数据</span></span><br><span class="line"><span class="comment">//使用Environment来获取，需要获取权限来操作</span></span><br><span class="line">Environment.getExternalStorageDirectory();</span><br></pre></td></tr></table></figure>
<p>与上述的对应方法的不同点</p>
<ul>
<li>系统一般不会清理在里面的文件</li>
<li>用户可能操作在里面的文件，使用时应该加个非空判断</li>
<li>获取WRITE_EXTERNAL_STORAGE的其他应用可以操作该文件</li>
</ul>
<p>注意: 随应用卸载后删除</p>
<ul>
<li>type的取值<br>type:(可以为null，为null时： /storage/emulated/0/Android/data/com.example.androidbase/files)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DIRECTORY_MUSIC, 为DIRECTORY_MUSIC时：/storage/emulated/<span class="number">0</span>/Android/data/com.example.androidbase/files/Music</span><br><span class="line">DIRECTORY_PODCASTS,</span><br><span class="line">DIRECTORY_RINGTONES,</span><br><span class="line">DIRECTORY_ALARMS,</span><br><span class="line">DIRECTORY_NOTIFICATIONS,</span><br><span class="line">DIRECTORY_PICTURES,</span><br><span class="line">DIRECTORY_MOVIES.</span><br></pre></td></tr></table></figure>
<ul>
<li>外部储存的公共目录</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 需要申请权限</span></span><br><span class="line"><span class="comment"> * Type的值看上面（不能为null）,注意要创建文件时不能使用 File的 mkdir() 和 mkdirs() 方法，它们只会创建目录，可以使用</span></span><br><span class="line"><span class="comment"> *createNewFile()或者不使用 都可以创建文件</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Environment.getExternalStoragePublicDirectory(String type);</span><br></pre></td></tr></table></figure>
<ul>
<li>因为外部存储可能是不可用的，比如遇到SD卡被拔出等情况时。因此在访问之前应对其可用性进行检查。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*检查外部存储是否可以读写*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExternalStorageWritable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String state = Environment.getExternalStorageState();</span><br><span class="line">    <span class="keyword">if</span> (Environment.MEDIA_MOUNTED.equals(state)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 检查外部存储是否可读 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExternalStorageReadable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String state = Environment.getExternalStorageState();</span><br><span class="line">    <span class="keyword">if</span> (Environment.MEDIA_MOUNTED.equals(state) ||</span><br><span class="line">        Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查询剩余空间</li>
</ul>
<p>如果事先知道想要保存的文件大小，可以通过执行getFreeSpace() or getTotalSpace() 来判断是否有足够的空间来保存文件，从而避免发生IOException。那些方法提供了当前可用的空间还有存储系统的总容量。然而，系统并不能保证可以写入通过getFreeSpace()查询到的容量文件， 如果查询的剩余容量比我们的文件大小多几MB，或者说文件系统使用率还不足90%，这样则可以继续进行写的操作，否则最好不要写进去。</p>
<blockquote>
<p>并没有强制要求在写文件之前去检查剩余容量。我们可以尝试先做写的动作，然后通过捕获 IOException 。这种做法仅适合于事先并不知道想要写的文件的确切大小。例如，如果在把PNG图片转换成JPEG之前，我们并不知道最终生成的图片大小是多少。</p>
</blockquote>
<ul>
<li>手动删除文件</li>
</ul>
<blockquote>
<p>在不需要使用某些文件的时候应删除它。删除文件最直接的方法是直接执行文件的delete()方法。</p>
</blockquote>
<p><code>myFile.delete();</code></p>
<blockquote>
<p>如果文件是保存在internal storage，我们可以通过Context来访问并通过执行deleteFile()进行删除</p>
</blockquote>
<p><code>Context.deleteFile(fileName);</code></p>
<p>更详细的可以参考：</p>
<ul>
<li><a href="https://juejin.im/post/58b557de128fe10065e93cc8" target="_blank" rel="noopener">Android存储（1）– 你还在乱用Android存储嘛！！！</a></li>
<li><a href="https://juejin.im/entry/58cb92415c497d0057b6c1a9" target="_blank" rel="noopener">Android 存储路径你了解多少</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/13/java注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/13/java注解/" itemprop="url">java注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-13T15:48:08+08:00">
                2019-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h2><p>元注解是一种可以注解到注解上的注解，是一种基本的注解，元注解有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span> ：解释这个注解的存活时间</span><br><span class="line"><span class="meta">@Documented</span> ：将注解中的元素包含到Javadoc中去</span><br><span class="line"><span class="meta">@Target</span> ：指定注解的应用场景</span><br><span class="line"><span class="meta">@Inherited</span> ：指定注解是否会被子类使用，例如：重写父类的方法时，如果要重写的方法有注解，则重写的方法也会出现该注解</span><br><span class="line"><span class="meta">@Repeatable</span>() ：可重复（Java <span class="number">1.8</span> 才加进来的）</span><br></pre></td></tr></table></figure>
<h3 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h3><p>@Retention取值如下：</p>
<ul>
<li>RetentionPolicy.SOURCE 注解只在源码阶段保留，在编译器进行编译时它将被丢弃忽视。例如（@Override）</li>
<li>RetentionPolicy.CLASS 注解只被保留到编译进行的时候，它并不会被加载到 JVM 中。 例如（@NotNull）</li>
<li>RetentionPolicy.RUNTIME 注解可以保留到程序运行的时候，它会被加载进入到 JVM 中，所以在程序运行时可以获取到它们.例如Retrofit2中的（@GET()）</li>
</ul>
<h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h3><p><code>@Target</code>的取值如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ElementType.ANNOTATION_TYPE 可以给一个注解进行注解</span><br><span class="line">ElementType.CONSTRUCTOR 可以给构造方法进行注解</span><br><span class="line">ElementType.FIELD 可以给属性进行注解</span><br><span class="line">ElementType.LOCAL_VARIABLE 可以给局部变量进行注解</span><br><span class="line">ElementType.METHOD 可以给方法进行注解</span><br><span class="line">ElementType.PACKAGE 可以给一个包进行注解（使用方法很特殊）</span><br><span class="line">ElementType.PARAMETER 可以给一个方法内的参数进行注解</span><br><span class="line">ElementType.TYPE 可以给一个类型进行注解，比如类、接口、枚举如果不声明则可以应用于所有的注解</span><br></pre></td></tr></table></figure>
<h3 id="Repeatable"><a href="#Repeatable" class="headerlink" title="@Repeatable()"></a>@Repeatable()</h3><p>表示注解的值是否可以取多个</p>
<h3 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h3><p>指定注解是否会被子类使用，比如如果一个超类被 @Inherited 注解过的注解进行注解的话，那么如果它的子类没有被任何注解应用的话，那么这个子类就继承了超类的注解</p>
<h3 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h3><p>与文档有关的元注解，在生成javadoc文档的时候将该Annotation也写入到文档中</p>
<h2 id="注解的定义"><a href="#注解的定义" class="headerlink" title="注解的定义"></a>注解的定义</h2><h2 id="注解的属性"><a href="#注解的属性" class="headerlink" title="注解的属性"></a>注解的属性</h2><p>注解的属性也叫做成员变量。注解只有成员变量，没有方法。注解的成员变量在注解的定义中以“无形参的方法”形式来声明，其方法名定义了该成员变量的名字，其返回值定义了该成员变量的类型</p>
<blockquote>
<p>需要注意的是，在注解中定义属性时它的类型必须是 8 种基本数据类型外加 类、接口、注解及它们的数组。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/11/java日期和时间api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lichukuan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/user.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/11/java日期和时间api/" itemprop="url">java日期和时间api</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-11T08:57:30+08:00">
                2019-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>java8之后推出了新的time api.</p>
<p>java.time包下有5个包组成(大部分人用到基础包和format包就足够了)</p>
<ul>
<li>java.time – 包含值对象的基础包</li>
<li>java.time.chrono – 提供对不同的日历系统的访问</li>
<li>java.time.format – 格式化和解析时间和日期</li>
<li>java.time.temporal – 包括底层框架和扩展特性</li>
<li>java.time.zone – 包含时区支持的类</li>
</ul>
<p>注意：java.time包下所有类都是不可变的、线程安全的</p>
<h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2><p>java的<code>Date</code>和<code>Time API</code>规范要求Java使用的时间尺度为:</p>
<ul>
<li>每天<code>86400</code>秒</li>
<li>每天正午与官方时间精准匹配</li>
<li>在时间点上，以精确的方式与官方时间接近匹配</li>
</ul>
<h2 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a>Instant</h2><p>在<code>java</code>中，<code>Instant</code>表示时间线上的某一点。<code>、该时间线的原点为:穿过伦敦格林威治皇家天文台的本初子午线所处时区
的</code>1970年1月1日的午夜`</p>
<p>Instant的常用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Instant <span class="title">now</span><span class="params">()</span> <span class="comment">//获取当前时间</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">getEpochSecond</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">toEpochMilli</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getNano</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">Instant <span class="title">plusMillis</span><span class="params">(<span class="keyword">long</span> millisToAdd)</span><span class="comment">//返回当前时间增加指定毫秒数后的时间</span></span></span><br><span class="line"><span class="function">Instant <span class="title">plusNanos</span><span class="params">(<span class="keyword">long</span> millisToAdd)</span><span class="comment">//返回当前时间增加指定纳秒数后的时间</span></span></span><br><span class="line"><span class="function">Instant <span class="title">plusSeconds</span><span class="params">(<span class="keyword">long</span> millisToAdd)</span><span class="comment">//返回当前时间增加指定秒数后的时间</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isAfter</span><span class="params">(Instant otherInstant)</span></span>;</span><br><span class="line"><span class="keyword">boolean</span> instant.isBefore(Instant otherInstant);</span><br><span class="line"></span><br><span class="line">MIN <span class="comment">//最小值，代表原点前的十亿年</span></span><br><span class="line">MAX <span class="comment">//最大值，代表公元 1000 000 000年的12月31日</span></span><br></pre></td></tr></table></figure>
<p>实例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Instant instant = Instant.now();</span><br><span class="line">        System.out.println(instant.toString());</span><br><span class="line">        System.out.println(instant.getEpochSecond());<span class="comment">//返回从原点到现在的秒数</span></span><br><span class="line">        System.out.println(instant.getNano());<span class="comment">//当前一秒内的第几纳秒</span></span><br><span class="line">        System.out.println(instant.toEpochMilli());<span class="comment">//返回从原点到现在的毫秒数</span></span><br><span class="line">        System.out.println(instant.plusMillis(<span class="number">10000</span>));</span><br><span class="line">        System.out.println(instant.plusNanos(<span class="number">1000</span>));;</span><br><span class="line">        System.out.println(instant.plusSeconds(<span class="number">1000</span>));;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">结果:</span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>T01:<span class="number">38</span>:<span class="number">22.067</span>Z</span><br><span class="line"><span class="number">1554946702</span></span><br><span class="line"><span class="number">67000000</span></span><br><span class="line"><span class="number">1554946702067</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>T01:<span class="number">38</span>:<span class="number">32.067</span>Z</span><br><span class="line"><span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>T01:<span class="number">38</span>:<span class="number">22.067001</span>Z</span><br><span class="line"><span class="number">2019</span>-<span class="number">04</span>-<span class="number">11</span>T01:<span class="number">55</span>:<span class="number">02.067</span>Z</span><br></pre></td></tr></table></figure>
<h2 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h2><p><code>Duration</code>是两个时刻之间的时间量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Instant start = Instant.now();</span><br><span class="line">run();<span class="comment">//延时方法</span></span><br><span class="line">Instant end = Instant.now();</span><br><span class="line">Duration t = Duration.between(start,end);</span><br><span class="line">System.out.println(t.toDays());<span class="comment">//获取时间经过的天数</span></span><br><span class="line">System.out.println(t.toHours());<span class="comment">//获取时间经过的小时数</span></span><br><span class="line">System.out.println(t.toMinutes());<span class="comment">//获取时间经过的分钟数</span></span><br><span class="line">System.out.println(t.getSeconds());<span class="comment">//获取时间经过的秒数</span></span><br><span class="line">System.out.println(t.toMillis());<span class="comment">//获取时间经过的毫秒数</span></span><br><span class="line">System.out.println(t.toNanos());<span class="comment">//获取时间经过的纳秒数</span></span><br><span class="line">System.out.println(t.toString());</span><br><span class="line">System.out.println(t.getNano());<span class="comment">//和Instant.getNano()方法相同</span></span><br><span class="line"></span><br><span class="line">Duration plus = t.plusDays(<span class="number">1</span>);<span class="comment">//在当前Duration加上指定天数的时间，其他plusXXX()不再介绍</span></span><br><span class="line">Duration min = t.minusDays(<span class="number">1</span>);<span class="comment">//在当前Duration减去指定天数的时间，其他minusXXX()不再介绍</span></span><br></pre></td></tr></table></figure>
<h2 id="本地时间"><a href="#本地时间" class="headerlink" title="本地时间"></a>本地时间</h2><p>转载<a href="https://www.jianshu.com/p/19bd58b30660" target="_blank" rel="noopener">java 8的java.time包(非常值得推荐)</a></p>
<ul>
<li>LocalDateTime：存储了日期和时间</li>
<li>LocalDate：只存储了日期</li>
<li>LocalTime：只存储了时间，如：14:02:43.455。(后面的.455表示毫秒值的最后三位,使用.withNano(0)可把毫秒值设为0)</li>
</ul>
<p>java.time.LocalDateTime</p>
<p>此类显示的是年月日时分秒(默认的格式为:2017-01-01T01:01:01.555)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">        System.out.println(now.toString());</span><br><span class="line">        System.out.println(now.getYear());</span><br><span class="line">        System.out.println(now.getMonthValue());</span><br><span class="line">        System.out.println(now.getDayOfMonth());</span><br><span class="line">        System.out.println(now.getHour()); <span class="comment">//24小时制</span></span><br><span class="line">        System.out.println(now.getMinute());</span><br><span class="line">        System.out.println(now.getSecond());</span><br><span class="line">        System.out.println(now.getNano()); <span class="comment">//毫秒值的后三位作为前三位后面补6个零</span></span><br><span class="line"></span><br><span class="line">打印的结果为:  </span><br><span class="line"><span class="number">2017</span>-<span class="number">03</span>-<span class="number">21</span>T20:<span class="number">26</span>:<span class="number">18.317</span></span><br><span class="line"><span class="number">2017</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">26</span></span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">317000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//能够自定义时间</span></span><br><span class="line">        LocalDateTime time = LocalDateTime.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        System.out.println(time); <span class="comment">//2017-01-01T01:01:01</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用plus方法增加年份</span></span><br><span class="line">        LocalDateTime time = LocalDateTime.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//改变时间后会返回一个新的实例nextYearTime</span></span><br><span class="line">        LocalDateTime nextYearTime = time.plusYears(<span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">        System.out.println(nextYearTime); <span class="comment">//2018-01-01T01:01:01</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用minus方法减年份</span></span><br><span class="line">        LocalDateTime time = LocalDateTime.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        LocalDateTime lastYearTime = time.minusYears(<span class="number">1</span>);</span><br><span class="line">        System.out.println(lastYearTime); <span class="comment">//2016-01-01T01:01:01</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用with方法设置月份</span></span><br><span class="line">        LocalDateTime time = LocalDateTime.of(<span class="number">2017</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        LocalDateTime changeTime = time.withMonth(<span class="number">12</span>);</span><br><span class="line">        System.out.println(changeTime); <span class="comment">//2017-12-01T01:01:01</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断当前年份是否闰年</span></span><br><span class="line">        System.out.println(<span class="string">"isLeapYear :"</span> + time.isLeapYear());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断当前日期属于星期几</span></span><br><span class="line">        LocalDateTime time = LocalDateTime.now();</span><br><span class="line">        DayOfWeek dayOfWeek = time.getDayOfWeek();</span><br><span class="line">        System.out.println(dayOfWeek); <span class="comment">//WEDNESDAY</span></span><br></pre></td></tr></table></figure>
<p>LocalDate</p>
<p>此类显示的是年月日(默认的格式为:2017-01-01)<br>用法与LocalDateTime类大致一样</p>
<p>LocalTime</p>
<p>此类显示的是时分秒和毫秒值的后三位(21:26:35.693)<br>用法与LocalDateTime类大致一样</p>
<h2 id="TemporalAdjusters"><a href="#TemporalAdjusters" class="headerlink" title="TemporalAdjusters"></a>TemporalAdjusters</h2><p><code>TemporalAdjusters</code>是调节器，通过<code>with</code>方法来调节时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">ofDateAdjuster</span><span class="params">(UnaryOperator&lt;LocalDate&gt; dateBasedAdjuster)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">firstDayOfMonth</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">lastDayOfMonth</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">firstDayOfNextMonth</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">firstDayOfYear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">lastDayOfYear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">firstDayOfNextYear</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">firstInMonth</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">lastInMonth</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">dayOfWeekInMonth</span><span class="params">(<span class="keyword">int</span> ordinal, DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">next</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">nextOrSame</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">previous</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TemporalAdjuster <span class="title">previousOrSame</span><span class="params">(DayOfWeek dayOfWeek)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LocalDate now = LocalDate.now();</span><br><span class="line">System.out.println(now.with(TemporalAdjusters.firstDayOfMonth()));</span><br></pre></td></tr></table></figure>
<h2 id="DateTimeFormatter"><a href="#DateTimeFormatter" class="headerlink" title="DateTimeFormatter"></a>DateTimeFormatter</h2><p>转载<a href="https://www.jianshu.com/p/19bd58b30660" target="_blank" rel="noopener">java 8的java.time包(非常值得推荐)</a></p>
<p>此类的功能与SimpleDateFormat类的功能类似,此类也是线程安全的,在写成时间处理工具类时,可作为静态成员变量,而不用每次都new一个SimpleDateFormat实例,此类是用来创建日期显示的模板,然后对于日期的格式化和解析还是使用LocalDateTime等类的parse静态方法和format方法,其模板属性格式是和SimpleDateFormat一样的,请看:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">G 年代标志符</span><br><span class="line">y 年</span><br><span class="line">M 月</span><br><span class="line">d 日</span><br><span class="line">h 时 (<span class="number">12</span>小时制)</span><br><span class="line">H 时 (<span class="number">24</span>小时制)</span><br><span class="line">m 分</span><br><span class="line">s 秒</span><br><span class="line">S 毫秒</span><br><span class="line">E 星期几</span><br><span class="line">D 一年中的第几天</span><br><span class="line">F 一月中第几个星期(以每个月<span class="number">1</span>号为第一周,<span class="number">8</span>号为第二周为标准计算)</span><br><span class="line">w 一年中第几个星期</span><br><span class="line">W 一月中第几个星期(不同于F的计算标准,是以星期为标准计算星期数,例如<span class="number">1</span>号是星期三,是当月的第一周,那么<span class="number">5</span>号为星期日就已经是当月的第二周了)</span><br><span class="line">a 上午 / 下午 标记符</span><br><span class="line">k 时 (<span class="number">24</span>小时制,其值与H的不同点在于,当数值小于<span class="number">10</span>时,前面不会有<span class="number">0</span>)</span><br><span class="line">K 时 (<span class="number">12</span>小时值,其值与h的不同点在于,当数值小于<span class="number">10</span>时,前面不会有<span class="number">0</span>)</span><br><span class="line">z 时区</span><br></pre></td></tr></table></figure>
<p>对于此类使用先来个简单的新旧api对比演示:</p>
<p>Date转String</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//使用Date和SimpleDateFormat</span></span><br><span class="line">  SimpleDateFormat simpleDateFormat = </span><br><span class="line">                  <span class="keyword">new</span> SimpleDateFormat(<span class="string">"G yyyy年MM月dd号 E a hh时mm分ss秒"</span>);</span><br><span class="line">  </span><br><span class="line">  String format = simpleDateFormat.format(<span class="keyword">new</span> Date());</span><br><span class="line">  </span><br><span class="line">  System.out.println(format); </span><br><span class="line">  <span class="comment">//打印: 公元 2017年03月21号 星期二 下午 06时38分20秒</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用jdk1.8 LocalDateTime和DateTimeFormatter</span></span><br><span class="line">  LocalDateTime now = LocalDateTime.now();</span><br><span class="line">  DateTimeFormatter pattern = </span><br><span class="line">             DateTimeFormatter.ofPattern(<span class="string">"G yyyy年MM月dd号 E a hh时mm分ss秒"</span>);</span><br><span class="line">  String format = now.format(pattern);</span><br><span class="line">  System.out.println(format);</span><br><span class="line"><span class="comment">//打印: 公元 2017年03月21号 星期二 下午 06时38分20秒</span></span><br></pre></td></tr></table></figure>
<p>String转Date</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//使用Date和SimpleDateFormat</span></span><br><span class="line">SimpleDateFormat simpleDateFormat = </span><br><span class="line">          <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">Date date = simpleDateFormat.parse(<span class="string">"2017-12-03 10:15:30"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(simpleDateFormat.format(date));</span><br><span class="line"><span class="comment">//打印 2017-12-03 10:15:30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用jdk1.8 LocalDateTime和DateTimeFormatter</span></span><br><span class="line">DateTimeFormatter pattern = </span><br><span class="line">            DateTimeFormatter.ofPattern(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//严格按照ISO yyyy-MM-dd验证，03写成3都不行</span></span><br><span class="line">LocalDateTime dt = LocalDateTime.parse(<span class="string">"2017-12-03 10:15:30"</span>,pattern); </span><br><span class="line"></span><br><span class="line">System.out.println(dt.format(pattern));</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/user.jpg" alt="lichukuan">
            
              <p class="site-author-name" itemprop="name">lichukuan</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">博客</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lichukuan</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
